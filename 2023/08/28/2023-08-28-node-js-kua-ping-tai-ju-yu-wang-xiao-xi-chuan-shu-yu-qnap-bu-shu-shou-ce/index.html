<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="WisdomEquan">
    
    <title>
        
            基于Node.js跨平台局域网消息传输与QNAP部署 |
        
        阳光下の少年
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="https://pic.imgdb.cn/item/652e034cc458853aef735cea.jpg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
        
            
                
<link rel="stylesheet" href="/css/custom.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"wisdomequan.github.io","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"language":"zh-CN","base_info":{"primary_color":"#badc58","title":"阳光下の少年","author":"WisdomEquan","avatar":"https://pic.imgdb.cn/item/652e034cc458853aef735cea.jpg","logo":"https://pic.imgdb.cn/item/652e034cc458853aef735cea.jpg","favicon":"https://pic.imgdb.cn/item/652e034cc458853aef735cea.jpg"},"menu":{"home":"/","archives":"/archives","tags":"/tags","categories":"/categories","links":"/links","tools":"/tools"},"first_screen":{"enable":true,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"随缘应变觉无界，因果循环见自然","hitokoto":false},"social_contact":{"enable":true,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":"m13619199464@163.com"}},"scroll":{"progress_bar":true,"percent":true,"hide_header":true},"home":{"announcement":null,"category":true,"tag":true,"post_datetime":"created"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":false,"reward":{"enable":false,"img_link":null,"text":null}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true,"layout":"left"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.21"},"waline":{"server_url":null,"reaction":false,"version":3},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2017,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":true,"css":["/css/custom.css"],"js":[null]},"root":"","source_data":{"links":[{"name":"changingself","link":"https://yxchangingself.xyz/","description":"一个挣扎着想改变自己的少年","avatar":"https://yxchangingself.xyz/img/avatar.png"},{"name":"endlesspeak","link":"https://endlesspeak.github.io/","description":"瞽者无以与乎文章之观,聋者无以与乎钟鼓之声。岂唯形骸有聋盲哉?","avatar":"https://endlesspeak.github.io/images/avtar.png"}],"tools":[{"category":"Minecraft Mod"},{"name":"安全的装备（safe armor）","link":"https://github.com/WisdomEquan/mods/tree/master/Minecraft/safe_armmor","description":"强大的武器和安全的装备","image":"/images/tools/safe_armmor_body.png"},{"name":"打印机（printer）","link":"https://github.com/WisdomEquan/mods/tree/master/Minecraft/printer","description":"可以复制物品的打印机","image":"/images/tools/printer_logo.png"}]},"links":[{"name":"changingself","link":"https://yxchangingself.xyz/","description":"一个挣扎着想改变自己的少年","avatar":"https://yxchangingself.xyz/img/avatar.png"},{"name":"endlesspeak","link":"https://endlesspeak.github.io/","description":"瞽者无以与乎文章之观,聋者无以与乎钟鼓之声。岂唯形骸有聋盲哉?","avatar":"https://endlesspeak.github.io/images/avtar.png"}],"version":"4.1.2"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="WisdomEquan" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="https://pic.imgdb.cn/item/652e034cc458853aef735cea.jpg">
                </a>
            
            <a class="site-name border-box" href="/">
               阳光下の少年
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                
                                首页
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                
                                归档
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                
                                标签
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                
                                分类
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                
                                友链
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/tools"
                            >
                                
                                工具
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/"
                    >首页</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives"
                    >归档</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags"
                    >标签</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories"
                    >分类</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links"
                    >友链</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tools"
                    >工具</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        基于Node.js跨平台局域网消息传输与QNAP部署
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="https://pic.imgdb.cn/item/652e034cc458853aef735cea.jpg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">WisdomEquan</span>
                                
                                    <span class="author-badge">Lv2</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2023-08-28 01:29:58</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Sun Oct 29 2023 16:45:03 GMT+0800">2023-10-29 16:45:03</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/Node-js/">Node.js</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/QNAP/">QNAP</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>17k 字</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>73 分钟</span>
            </span>
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body">
                    

                    <h2 id="0x1-引言"><a href="#0x1-引言" class="headerlink" title="0x1 引言"></a>0x1 引言</h2><h3 id="0x1-1-目的与背景"><a href="#0x1-1-目的与背景" class="headerlink" title="0x1.1 目的与背景"></a>0x1.1 目的与背景</h3><p><strong>当我刚进入大学时</strong>，我得到了我的第一台游戏本。当时，我经常需要在手机和电脑之间传输文件和文档。最初，我使用QQ和手机热点来进行传输，这显得相当繁琐。后来，我尝试了蓝牙传输，但速度过慢。尽管我使用了小米的热点文件传输功能，但仅为了传输简单的文本或图片，这样的操作还是过于复杂。</p>
<p><strong>毕业后</strong>，我的生活出现了很大的改变。拥有了路由器后，内网传输变得相对简单。但当我获得了iPhone和MacBook，我发现跨操作系统传输文件并不简单。例如，从iPhone向Windows传输文本或链接时，我还需依赖QQ等软件。尝试使用Windows的SMB共享服务和MacBook的文件共享都有其局限性和问题。</p>
<p><strong>后来</strong>，我转向开源的云盘解决方案，但传输速度的限制使我非常不满意。直到我获得了QNAP，大部分的文件传输问题得到了解决。然而，在局域网下保持Windows和MacBook数据的一致性，尤其是文本数据，依然是一个问题。显然，依赖QQ这样的方式效率低下。</p>
<p><strong>因此</strong>，创建一个简单的网页成为了一种必要，让任何设备仅通过输入一个地址就能发送消息，避免了下载和设置各种软件的麻烦。</p>
<h3 id="0x1-2-目标受众"><a href="#0x1-2-目标受众" class="headerlink" title="0x1.2 目标受众"></a>0x1.2 目标受众</h3><ol>
<li><p><strong>大学生和职场新人</strong>：他们经常在不同的设备之间传输文件和文档，尤其是在手机和电脑之间，需要一个高效的解决方案。</p>
</li>
<li><p><strong>跨操作系统用户</strong>：特别是那些使用iPhone和Windows或MacBook的人，他们经常面临操作系统之间的传输难题。</p>
</li>
<li><p><strong>网络技术爱好者</strong>：对于那些寻求局域网下文件和数据传输解决方案的人，他们可能已经尝试了各种方法，但仍然在寻找更加高效的方法。</p>
</li>
<li><p><strong>对效率有追求的人</strong>：不想依赖于多个应用程序和软件，而是寻求一个集中的、简化的解决方案来处理日常的文件和数据传输任务。</p>
</li>
<li><p><strong>云存储和网络存储用户</strong>：特别是那些使用开源云盘或QNAP这样的解决方案的人，他们在寻找更快、更直接的传输方法。</p>
</li>
</ol>
<h2 id="0x2-必要的理论知识解释"><a href="#0x2-必要的理论知识解释" class="headerlink" title="0x2 必要的理论知识解释"></a>0x2 必要的理论知识解释</h2><h3 id="0x2-1-基础概念"><a href="#0x2-1-基础概念" class="headerlink" title="0x2.1 基础概念"></a>0x2.1 基础概念</h3><ol>
<li><p><strong>文件传输</strong>：</p>
<ul>
<li><strong>定义</strong>：文件传输指的是从一个设备、系统或者位置将文件或数据移动到另一个设备、系统或位置的过程。</li>
<li><strong>应用</strong>：例如，通过USB、网络或云服务将文档从电脑传输到手机。</li>
</ul>
</li>
<li><p><strong>操作系统差异</strong>：</p>
<ul>
<li><strong>定义</strong>：不同的操作系统（如Windows、MacOS、Linux等）在架构、功能和界面上有所不同。</li>
<li><strong>应用</strong>：某些软件可能只在特定操作系统上运行，或在不同系统上有不同的表现。</li>
</ul>
</li>
<li><p><strong>局域网(LAN)原理</strong>：</p>
<ul>
<li><strong>定义</strong>：局域网是一个限定在较小地理范围内（如家庭、办公室）的计算机网络。</li>
<li><strong>应用</strong>：局域网使得同一位置的多台设备可以共享资源，如打印机或文件。</li>
</ul>
</li>
<li><p><strong>蓝牙和热点传输</strong>：</p>
<ul>
<li><strong>定义</strong>：蓝牙是一种无线技术标准，用于短距离数据交换，而热点传输则是通过Wi-Fi将文件从一个设备分享到另一个设备。</li>
<li><strong>应用</strong>：例如，用蓝牙耳机听音乐或使用手机热点给电脑上网。</li>
</ul>
</li>
<li><p><strong>云存储与网络存储</strong>：</p>
<ul>
<li><strong>定义</strong>：云存储是通过互联网存储数据在远程服务器上的服务；网络存储则是在局域网内提供集中化的数据存储。</li>
<li><strong>应用</strong>：如，使用Google Drive或Dropbox来存储文件或使用NAS来在家庭网络中共享文件。</li>
</ul>
</li>
<li><p><strong>跨平台兼容性</strong>：</p>
<ul>
<li><strong>定义</strong>：指的是软件或应用在多个操作系统或设备上的运行能力。</li>
<li><strong>应用</strong>：例如，一个应用既可以在Android上运行，也可以在iOS上运行。</li>
</ul>
</li>
<li><p><strong>Web技术基础</strong>：</p>
<ul>
<li><strong>定义</strong>：关于如何构建和呈现互联网内容的技术和原理。</li>
<li><strong>应用</strong>：例如，使用HTML、CSS和JavaScript来构建网页。</li>
</ul>
</li>
<li><p><strong>Node.js</strong>：</p>
<ul>
<li><strong>定义</strong>：是一个允许在服务器上运行JavaScript的运行时环境。</li>
<li><strong>应用</strong>：例如，构建后端API或Web应用。</li>
</ul>
</li>
<li><p><strong>HTML</strong>：</p>
<ul>
<li><strong>定义</strong>：是用来描述网页结构的标记语言。</li>
<li><strong>应用</strong>：例如，定义网页中的标题、段落和链接。</li>
</ul>
</li>
<li><p><strong>CSS</strong>：</p>
</li>
</ol>
<ul>
<li><strong>定义</strong>：是用于描述网页外观和格式的语言。</li>
<li><strong>应用</strong>：例如，设置字体、颜色和布局。</li>
</ul>
<ol start="11">
<li><strong>Socket</strong>：</li>
</ol>
<ul>
<li><strong>定义</strong>：是计算机之间进行通信的端点。</li>
<li><strong>应用</strong>：例如，实时聊天应用。</li>
</ul>
<ol start="12">
<li><strong>Server</strong>：</li>
</ol>
<ul>
<li><strong>定义</strong>：是为其他计算机或应用提供资源、服务或数据的系统或应用。</li>
<li><strong>应用</strong>：例如，Web服务器存储和提供网页内容。</li>
</ul>
<ol start="13">
<li><strong>Docker</strong>：</li>
</ol>
<ul>
<li><strong>定义</strong>：是一个平台，用于创建、运行和管理容器化的应用。</li>
<li><strong>应用</strong>：例如，为应用提供一致的运行环境。</li>
</ul>
<ol start="14">
<li><strong>IP地址</strong>：</li>
</ol>
<ul>
<li><strong>定义</strong>：是分配给联网设备的数字地址，用于识别和定位。</li>
<li><strong>应用</strong>：例如，访问特定的网站或远程服务器。</li>
</ul>
<ol start="15">
<li><strong>User Agent</strong>：</li>
</ol>
<ul>
<li><strong>定义</strong>：是描述浏览器或其他客户端如何与服务器通信的字符串。</li>
<li><strong>应用</strong>：例如，网站可以识别用户的设备和浏览器，并据此提供优化的内容。</li>
</ul>
<h3 id="0x2-2-相关技术背景"><a href="#0x2-2-相关技术背景" class="headerlink" title="0x2.2 相关技术背景"></a>0x2.2 相关技术背景</h3><p>随着技术的日益发展，文件传输和数据共享已经成为现代工作和生活中不可或缺的部分。无论是学生、企业家还是日常用户，我们都经常面临跨设备、跨操作系统的数据传输挑战。</p>
<ol>
<li><p><strong>文件传输</strong>：这是一种基本的需求，涉及将文件从一个设备传送到另一个设备。尽管有许多可用的方法，例如USB、蓝牙和热点传输，但它们都有自己的局限性和速度问题。</p>
</li>
<li><p><strong>操作系统差异</strong>：由于Windows、MacOS和其他操作系统的内在差异，许多应用和服务在跨操作系统通信时面临挑战。</p>
</li>
<li><p><strong>局域网原理</strong>：局域网为设备提供了一种在有限的地理范围内共享资源的方式。例如，家庭或办公室内的设备可以通过局域网共享打印机或文件。</p>
</li>
<li><p><strong>蓝牙与热点传输</strong>：尽管这两种技术都提供了一种无线传输方式，但它们通常受限于传输距离和速度。</p>
</li>
<li><p><strong>云存储与网络存储</strong>：为了解决大文件传输的问题，许多用户转向了云存储或网络存储解决方案，如Google Drive或NAS。</p>
</li>
<li><p><strong>跨平台兼容性</strong>：这是当今技术世界中的一大挑战。由于多样性的增加，需要开发可以在多个平台上运行的应用。</p>
</li>
<li><p><strong>Web技术基础</strong>：HTML、CSS和JavaScript等技术为创建跨平台解决方案提供了基础，允许用户通过浏览器访问应用和服务。</p>
</li>
<li><p><strong>服务器和后端技术</strong>：Node.js提供了一个强大的平台，用于构建后端服务和API，而Socket技术使实时通信成为可能。这些技术经常被用于创建动态、实时的Web应用。</p>
</li>
<li><p><strong>容器化技术</strong>：Docker为开发者提供了一种方式，将其应用及其所有依赖性封装在一个容器中，确保其在任何环境中的一致性和可移植性。</p>
</li>
<li><p><strong>网络识别</strong>：IP地址和User Agent允许设备和网络服务识别请求的来源，从而为用户提供个性化的体验和内容。</p>
</li>
</ol>
<h2 id="0x3-Node-js原型开发"><a href="#0x3-Node-js原型开发" class="headerlink" title="0x3 Node.js原型开发"></a>0x3 Node.js原型开发</h2><h3 id="0x3-1-环境配置"><a href="#0x3-1-环境配置" class="headerlink" title="0x3.1 环境配置"></a>0x3.1 环境配置</h3><p>初始化项目</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir realtime-text</span><br><span class="line"><span class="built_in">cd</span> realtime-text</span><br></pre></td></tr></tbody></table></figure>

<p>安装<a class="link" target="_blank" rel="noopener" href="https://nodejs.org/en">Node.js<i class="fas fa-external-link-alt"></i></a>，最好选择LTS版本，在项目根目录执行</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install express socket.io</span><br><span class="line">npm install multer</span><br></pre></td></tr></tbody></table></figure>

<h3 id="0x3-2-基本功能实现"><a href="#0x3-2-基本功能实现" class="headerlink" title="0x3.2 基本功能实现"></a>0x3.2 基本功能实现</h3><p><strong>创建服务器 (server.js)</strong></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> socketIo = <span class="built_in">require</span>(<span class="string">'socket.io'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> server = http.createServer(app);</span><br><span class="line"><span class="keyword">const</span> io = socketIo(server);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/socket.io'</span>, express.static(<span class="string">'node_modules/socket.io/client-dist/'</span>));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    res.sendFile(__dirname + <span class="string">'/index.html'</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a user connected'</span>);</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'send text'</span>, <span class="function">(<span class="params">text</span>) =&gt;</span> {</span><br><span class="line">        io.emit(<span class="string">'receive text'</span>, text);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'user disconnected'</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'listening on *:3000'</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p><strong>创建前端页面 (index.html)</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Realtime Text<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"textArea"</span> <span class="attr">rows</span>=<span class="string">"10"</span> <span class="attr">cols</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendButton"</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Received Text:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"receivedText"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> socket = io();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.getElementById(<span class="string">'sendButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value;</span></span><br><span class="line"><span class="javascript">        socket.emit(<span class="string">'send text'</span>, text);</span></span><br><span class="line"><span class="javascript">      };</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      socket.on(<span class="string">'receive text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'receivedText'</span>).innerText = text;</span></span><br><span class="line"><span class="javascript">      });</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>启动服务器</strong></p>
<p>本地服务器默认地址：<a class="link" target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></tbody></table></figure>

<p><strong>创建启动服务器脚本 (run.bat)</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br><span class="line">pause</span><br></pre></td></tr></tbody></table></figure>



<h2 id="0x4-按需复制，无需深究学习"><a href="#0x4-按需复制，无需深究学习" class="headerlink" title="0x4 按需复制，无需深究学习"></a>0x4 按需复制，无需深究学习</h2><p>不想学习思路直接运行代码，按照以下步骤操作，如果需要上传NAS请继续阅读 <strong>0xA Docker封装与测试</strong></p>
<p>创建对应的目录结构，并把<code>index.html</code>和<code>server.js</code>这两个的代码复制到你的网站根目录下</p>
<p>下载<a class="link" target="_blank" rel="noopener" href="https://www.jetbrains.com/lp/mono/">JetBrains Mono<i class="fas fa-external-link-alt"></i></a>字体，解压<code>JetBrainsMono-Regular.ttf</code>、<code>JetBrainsMono-Regular.woff2</code>到网站根目录</p>
<p>现在你的目录结构应该是这样的</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> D:\realtime_text 的目录</span><br><span class="line">2023/08/27  04:51            11,332 index.html</span><br><span class="line">2023/01/14  23:20           273,900 JetBrainsMono-Regular.ttf</span><br><span class="line">2023/01/14  23:20            92,164 JetBrainsMono-Regular.woff2</span><br><span class="line">2023/08/27  01:47    &lt;DIR&gt;          node_modules</span><br><span class="line">2023/08/27  01:12                52 run.bat</span><br><span class="line">2023/08/27  01:49             1,942 server.js</span><br><span class="line">2023/08/27  13:27    &lt;DIR&gt;          uploads</span><br></pre></td></tr></tbody></table></figure>

<h3 id="0x4-1-index-html"><a href="#0x4-1-index-html" class="headerlink" title="0x4.1 index.html"></a>0x4.1 index.html</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Realtime Text<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> <span class="selector-tag">input</span>, <span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> <span class="selector-tag">textarea</span>, <span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> <span class="selector-tag">button</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: white;  <span class="comment">/* 将文字颜色设置为白色 */</span></span></span><br><span class="line"><span class="css">            <span class="attribute">border-color</span>: white; <span class="comment">/* 如果需要, 也可以设置边框颜色 */</span></span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-pseudo">:root</span> {</span></span><br><span class="line"><span class="css">            <span class="comment">/* 浅色模式的设置 */</span></span></span><br><span class="line"><span class="css">            --text-<span class="attribute">color</span>: black;</span></span><br><span class="line"><span class="css">            --<span class="attribute">background-color</span>: white;</span></span><br><span class="line"><span class="css">            --<span class="selector-tag">input</span>-bg: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">            --container-bg: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">            --<span class="selector-tag">header</span>-bg: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">            --<span class="selector-tag">button</span>-<span class="attribute">color</span>: black; <span class="comment">/* 新增 */</span></span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> {</span></span><br><span class="line"><span class="css">            <span class="comment">/* 深色模式的设置 */</span></span></span><br><span class="line"><span class="css">            --text-<span class="attribute">color</span>: black;  <span class="comment">/* 文本颜色为黑色 */</span></span></span><br><span class="line"><span class="css">            --<span class="attribute">background-color</span>: white;  <span class="comment">/* 背景颜色为白色 */</span></span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.bottom-controls</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.bottom-controls</span> &gt; <span class="selector-tag">div</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">display</span>: flex; <span class="comment">/* 这确保了内部容器的子元素水平对齐 */</span></span></span><br><span class="line"><span class="css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="comment">/* 为固定底部工具栏添加填充 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="comment">/* 保证body的背景颜色被应用 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--background-color) <span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span></span><br><span class="line"><span class="css">            <span class="attribute">font-family</span>: <span class="string">"JetBrainsMono"</span>, Arial, sans-serif;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.container</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="comment">/* 小屏幕的样式(如iphone) */</span></span></span><br><span class="line"><span class="css">        <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span></span><br><span class="line"><span class="css">            <span class="selector-class">.bottom-controls</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">justify-content</span>: flex-start; <span class="comment">/* 这将使内部容器与起始位置对齐 */</span></span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-class">.bottom-controls</span> &gt; <span class="selector-tag">div</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">flex-direction</span>: column; <span class="comment">/* 这确保了内部容器的子容器是垂直堆叠的 */</span></span></span><br><span class="line"><span class="css">                <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">            <span class="comment">/* 更新底部控件的容器样式 */</span></span></span><br><span class="line"><span class="css">            <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">background-color</span>: <span class="built_in">var</span>(--container-bg);</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">                <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">                <span class="attribute">flex-direction</span>: column;  <span class="comment">/* 确保控件垂直堆叠 */</span></span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">            <span class="comment">/* 确保所有控件拉伸以填充可用宽度 */</span></span></span><br><span class="line"><span class="css">            <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">background-color</span>: <span class="built_in">var</span>(--container-bg);</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">box-sizing</span>: border-box;  <span class="comment">/* 确保填充和边框包含在宽度中 */</span></span></span><br><span class="line"><span class="css">                <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;  <span class="comment">/* 添加控件之间的间距 */</span></span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">            <span class="comment">/* 增加高度，便于触摸 */</span></span></span><br><span class="line"><span class="css">            <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#sendButton</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="comment">/* 在邮件列表的底部添加填充 */</span></span></span><br><span class="line"><span class="css">            <span class="selector-id">#messages</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">padding-bottom</span>: <span class="number">70px</span>; <span class="comment">/* 根据底部工具栏的高度调整此值 */</span></span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-id">#deleteButton</span>{</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-class">.container</span>{</span></span><br><span class="line"><span class="css">                <span class="attribute">max-height</span>: <span class="number">480px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-id">#themeToggle</span>{</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="comment">/* 大屏幕的样式(例如，Windows, MacBook) */</span></span></span><br><span class="line"><span class="css">        <span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">501px</span>) {</span></span><br><span class="line"><span class="css">            <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">background-color</span>: <span class="built_in">var</span>(--input-bg);</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-id">#textArea</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-id">#sendButton</span> {</span></span><br><span class="line"><span class="css">                <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>; <span class="comment">/* 调整按钮的填充 */</span></span></span><br><span class="line"><span class="css">                <span class="attribute">margin-left</span>: <span class="number">10px</span>; <span class="comment">/* 在发送按钮的左侧添加一些边距，以保持间距 */</span></span></span><br><span class="line"><span class="css">                <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-id">#deleteButton</span>{</span></span><br><span class="line"><span class="css">                <span class="attribute">margin-left</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">            <span class="selector-id">#themeToggle</span>{</span></span><br><span class="line"><span class="css">                <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="css">                <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="css">            }</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span>, <span class="selector-tag">button</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="comment">/* 为了确保按钮的文本颜色能够在两种主题下都清晰可见 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">button</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="built_in">var</span>(--button-color);</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="comment">/* 底部控件的文本颜色 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-class">.bottom-controls</span> <span class="selector-tag">input</span>,</span></span><br><span class="line"><span class="css">        <span class="selector-class">.bottom-controls</span> <span class="selector-tag">textarea</span>,</span></span><br><span class="line"><span class="css">        <span class="selector-class">.bottom-controls</span> <span class="selector-tag">button</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span></span><br><span class="line"><span class="css">            <span class="attribute">border-color</span>: <span class="built_in">var</span>(--text-color);</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.container</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--container-bg);</span></span><br><span class="line"><span class="css">            <span class="attribute">overflow-y</span>: auto;</span></span><br><span class="line"><span class="css">            <span class="attribute">min-width</span>: <span class="number">350px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">position</span>: sticky;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-bottom</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span><span class="selector-class">.dark-theme</span> {</span></span><br><span class="line"><span class="css">            <span class="comment">/* 深色模式的设置 */</span></span></span><br><span class="line"><span class="css">            --text-<span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="css">            --<span class="attribute">background-color</span>: <span class="number">#555</span>;</span></span><br><span class="line"><span class="css">            --<span class="selector-tag">input</span>-bg: <span class="number">#555</span>;</span></span><br><span class="line"><span class="css">            --container-bg: <span class="number">#444</span>;</span></span><br><span class="line"><span class="css">            --<span class="selector-tag">header</span>-bg: <span class="number">#444</span>;</span></span><br><span class="line"><span class="css">            --<span class="selector-tag">button</span>-<span class="attribute">color</span>: white; <span class="comment">/* 新增 */</span></span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-id">#header</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--header-bg);</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="keyword">@font-face</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">font-family</span>: <span class="string">"JetBrainsMono"</span>; <span class="comment">/* 可以为字体起一个名字 */</span></span></span><br><span class="line"><span class="css">            <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'JetBrainsMono-Regular.woff2'</span>) <span class="built_in">format</span>(<span class="string">'woff2'</span>), /* 最优先 */</span></span><br><span class="line"><span class="css">            <span class="built_in">url</span>(<span class="string">'JetBrainsMono-Regular.ttf'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>);</span></span><br><span class="line"><span class="css">            <span class="attribute">font-weight</span>: normal;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-style</span>: normal;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"header"</span> <span class="attr">style</span>=<span class="string">"background-color: var(--container-bg);"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"messages"</span> <span class="attr">style</span>=<span class="string">"max-height: 70vh"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 调整底部工具栏结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bottom-controls"</span> <span class="attr">style</span>=<span class="string">"position: fixed; bottom: 0; width: 100%; padding: 5px; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); background-color: var(--container-bg);"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"display: flex; align-items: center;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"themeToggle"</span>&gt;</span>切换主题<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"deviceName"</span> <span class="attr">placeholder</span>=<span class="string">"Device Name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"imageUpload"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"textArea"</span> <span class="attr">placeholder</span>=<span class="string">"写点什么？！"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendButton"</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"deleteButton"</span>&gt;</span>删除选中消息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">        }, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 请求历史消息</span></span></span><br><span class="line"><span class="javascript">        fetch(<span class="string">'/messages'</span>)</span></span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span></span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="params">data</span> =&gt;</span> {</span></span><br><span class="line"><span class="javascript">                <span class="keyword">const</span> messagesDiv = <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>);</span></span><br><span class="line"><span class="javascript">                data.messages.forEach(<span class="function"><span class="params">message</span> =&gt;</span> {</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">const</span> p = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span></span><br><span class="line"><span class="javascript">                    p.textContent = message;</span></span><br><span class="line"><span class="javascript">                    messagesDiv.appendChild(p);</span></span><br><span class="line"><span class="javascript">                });</span></span><br><span class="line"><span class="javascript">            })</span></span><br><span class="line"><span class="javascript">            .catch(<span class="function"><span class="params">error</span> =&gt;</span> {</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.error(<span class="string">'获取消息错误:'</span>, error);</span></span><br><span class="line"><span class="javascript">            });</span></span><br><span class="line"><span class="javascript">    });</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).scrollTop = <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).scrollHeight;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> socket = io();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">'sendButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> deviceName = <span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value || <span class="string">"匿名设备"</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> imageFile = <span class="built_in">document</span>.getElementById(<span class="string">'imageUpload'</span>).files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> listCheckBox = <span class="built_in">document</span>.getElementById(<span class="string">'listCheckBox'</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (imageFile) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">            formData.append(<span class="string">'image'</span>, imageFile);</span></span><br><span class="line"><span class="javascript">            formData.append(<span class="string">'deviceName'</span>, deviceName);</span></span><br><span class="line"><span class="javascript">            formData.append(<span class="string">'text'</span>, text);</span></span><br><span class="line"><span class="javascript">            formData.append(<span class="string">'listCheckBox'</span>, listCheckBox);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            fetch(<span class="string">'/upload-image'</span>, {</span></span><br><span class="line"><span class="javascript">                <span class="attr">method</span>: <span class="string">'POST'</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">body</span>: formData</span></span><br><span class="line"><span class="javascript">            }).then(<span class="function"><span class="params">response</span> =&gt;</span> response.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> {</span></span><br><span class="line"><span class="javascript">                socket.emit(<span class="string">'send text'</span>, data);</span></span><br><span class="line"><span class="javascript">            });</span></span><br><span class="line"><span class="javascript">        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="javascript">            socket.emit(<span class="string">'send text'</span>, {text, deviceName });</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 在所有情况下都清除textArea和图片选择器的值</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'imageUpload'</span>).value = <span class="string">''</span>;  <span class="comment">// 这将清除文件输入选择器的内容</span></span></span><br><span class="line"><span class="javascript">    };</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> messageId = <span class="number">0</span>;  <span class="comment">// 初始化一个全局变量</span></span></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">'receive text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 创建复选框</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> checkbox = <span class="built_in">document</span>.createElement(<span class="string">"input"</span>);</span></span><br><span class="line"><span class="javascript">        checkbox.type = <span class="string">"checkbox"</span>;</span></span><br><span class="line"><span class="javascript">        checkbox.className = <span class="string">"messageCheckbox"</span>;</span></span><br><span class="line"><span class="javascript">        li.appendChild(checkbox);  <span class="comment">// 将复选框添加到列表项中</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> time = data.timestamp || <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(); <span class="comment">// 获取时间戳，如果没有则使用当前时间</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> content = <span class="string">`[<span class="subst">${data.deviceName}</span> @ <span class="subst">${time}</span>]: `</span>; <span class="comment">// 显示设备名和时间</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (data.text.startsWith(<span class="string">"```"</span>) &amp;&amp; data.text.endsWith(<span class="string">"```"</span>)) {</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 如果文本以 "```" 开头和结尾，将其识别为代码</span></span></span><br><span class="line"><span class="javascript">            content += <span class="string">`&lt;pre&gt;<span class="subst">${data.text.slice(<span class="number">3</span>, -<span class="number">3</span>)}</span>&lt;/pre&gt;`</span>;</span></span><br><span class="line"><span class="javascript">        } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="javascript">            content += <span class="string">`<span class="subst">${data.text}</span>`</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (data.imageUrl) {</span></span><br><span class="line"><span class="javascript">            content += <span class="string">`&lt;br&gt;&lt;img   src="<span class="subst">${data.imageUrl}</span>"  alt="Uploaded image" style="max-width: 300px;"&gt;`</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        li.innerHTML += content;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).appendChild(li);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        li.setAttribute(<span class="string">'data-message-id'</span>, messageId);  <span class="comment">// 为每个消息设置唯一ID</span></span></span><br><span class="line"><span class="javascript">        messageId++;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"设备名称和IP地址:"</span>, data.deviceName);</span></span><br><span class="line"><span class="javascript">    });</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 发送HTTP DELETE请求到后端来删除消息</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">'deleteButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> selectedMessages = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.messageCheckbox:checked'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> messageIdsToDelete = [];</span></span><br><span class="line"><span class="javascript">        selectedMessages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">checkbox</span>) </span>{</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> li = checkbox.closest(<span class="string">'li'</span>);</span></span><br><span class="line"><span class="javascript">            messageIdsToDelete.push(li.getAttribute(<span class="string">'data-message-id'</span>));</span></span><br><span class="line"><span class="javascript">            li.remove();</span></span><br><span class="line"><span class="javascript">        });</span></span><br><span class="line"><span class="javascript">        socket.emit(<span class="string">'delete messages'</span>, messageIdsToDelete);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 向后端发送删除请求</span></span></span><br><span class="line"><span class="javascript">        messageIdsToDelete.forEach(<span class="function"><span class="params">id</span> =&gt;</span> {</span></span><br><span class="line"><span class="javascript">            fetch(<span class="string">`/message/<span class="subst">${id}</span>`</span>, {</span></span><br><span class="line"><span class="javascript">                <span class="attr">method</span>: <span class="string">'DELETE'</span></span></span><br><span class="line"><span class="javascript">            }).then(<span class="function"><span class="params">response</span> =&gt;</span> {</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (!response.ok) {</span></span><br><span class="line"><span class="javascript">                    <span class="comment">// 以某种方式处理错误响应</span></span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.error(<span class="string">'从服务器删除消息失败'</span>);</span></span><br><span class="line"><span class="javascript">                }</span></span><br><span class="line"><span class="javascript">            });</span></span><br><span class="line"><span class="javascript">        });</span></span><br><span class="line"><span class="javascript">    };</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">'delete messages'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">messageIds</span>) </span>{</span></span><br><span class="line"><span class="javascript">        messageIds.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">messageId</span>) </span>{</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> li = <span class="built_in">document</span>.querySelector(<span class="string">'li[data-message-id="'</span> + messageId + <span class="string">'"]'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (li) li.remove();</span></span><br><span class="line"><span class="javascript">        });</span></span><br><span class="line"><span class="javascript">        io.emit(<span class="string">'delete messages'</span>, messageIds);  <span class="comment">// 向所有客户端广播消息ID，以供删除</span></span></span><br><span class="line"><span class="javascript">    });</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 如果消息中的图像被点击</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (event.target.tagName === <span class="string">'IMG'</span> &amp;&amp; event.target.closest(<span class="string">'#messages'</span>)) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> modal = <span class="built_in">document</span>.getElementById(<span class="string">'imageModal'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> modalImage = <span class="built_in">document</span>.getElementById(<span class="string">'modalImage'</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            modalImage.src = event.target.src;</span></span><br><span class="line"><span class="javascript">            modal.style.display = <span class="string">'flex'</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            modal.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                modal.style.display = <span class="string">'none'</span>;</span></span><br><span class="line"><span class="javascript">            });</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">    });</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 按下'Escape'关闭模式</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(<span class="string">'keydown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (event.key === <span class="string">'Escape'</span>) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> modal = <span class="built_in">document</span>.getElementById(<span class="string">'imageModal'</span>);</span></span><br><span class="line"><span class="javascript">            modal.style.display = <span class="string">'none'</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript">    });</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getDeviceNameFromUserAgent</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> userAgent = navigator.userAgent || navigator.vendor || <span class="built_in">window</span>.opera;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// Windows Phone必须先行一步，因为它的用户界面也包含“Android”。</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="regexp">/windows phone/i</span>.test(userAgent)) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">"Windows Phone"</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="regexp">/android/i</span>.test(userAgent)) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">"Android Device"</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// iOS检测</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="regexp">/iPad|iPhone|iPod/</span>.test(userAgent) &amp;&amp; !<span class="built_in">window</span>.MSStream) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">"iOS Device"</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="regexp">/macintosh|mac os x/i</span>.test(userAgent)) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">"Mac"</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="regexp">/windows/i</span>.test(userAgent)) {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">"Windows PC"</span>;</span></span><br><span class="line"><span class="javascript">        }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="string">"匿名设备"</span>;</span></span><br><span class="line"><span class="javascript">    }</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 使用函数来自动填充设备名称</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value = getDeviceNameFromUserAgent();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 切换主题</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">'themeToggle'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.classList.toggle(<span class="string">'dark-theme'</span>);</span></span><br><span class="line"><span class="javascript">    });</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">'load history'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">history</span>) </span>{</span></span><br><span class="line"><span class="javascript">        history.forEach(<span class="function"><span class="params">data</span> =&gt;</span> {</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> content = <span class="string">`[<span class="subst">${data.deviceName}</span>]: <span class="subst">${data.text}</span>`</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (data.imageUrl) {</span></span><br><span class="line"><span class="javascript">                content += <span class="string">`&lt;br&gt;&lt;img   src="<span class="subst">${data.imageUrl}</span>"  alt="Uploaded image" style="max-width: 300px;"&gt;`</span>;</span></span><br><span class="line"><span class="javascript">            }</span></span><br><span class="line"><span class="javascript">            li.innerHTML = content;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).appendChild(li);</span></span><br><span class="line"><span class="javascript">        });</span></span><br><span class="line"><span class="javascript">    });</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 图像模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"imageModal"</span> <span class="attr">style</span>=<span class="string">"display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"modalImage"</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"max-width: 90%; max-height: 90%;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="0x4-2-server-js"><a href="#0x4-2-server-js" class="headerlink" title="0x4.2 server.js"></a>0x4.2 server.js</h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> socketIo = <span class="built_in">require</span>(<span class="string">'socket.io'</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">'multer'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> sqlite3 = <span class="built_in">require</span>(<span class="string">'sqlite3'</span>).verbose();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> server = http.createServer(app);</span><br><span class="line"><span class="keyword">const</span> io = socketIo(server);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messageHistory = [];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建或打开数据库</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="keyword">new</span> sqlite3.Database(<span class="string">'./messages.db'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建message表，如果存在则什么都不做</span></span><br><span class="line"><span class="comment">// 包含id、content、deviceName、 ipAddress、 timestamp字段</span></span><br><span class="line">db.run(<span class="string">"CREATE TABLE IF NOT EXISTS messages (id INTEGER PRIMARY KEY AUTOINCREMENT, content TEXT, deviceName TEXT, ipAddress TEXT, timestamp TEXT)"</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">if</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"创建/检查表错误:"</span>, err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"表检查/创建成功"</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在服务器启动时从数据库加载消息历史记录</span></span><br><span class="line">db.all(<span class="string">"SELECT id, content, deviceName, ipAddress, timestamp FROM messages"</span>, [], <span class="function">(<span class="params">err, rows</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">if</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"从数据库获取历史消息出错:"</span>, err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 遍历数据库每条记录</span></span><br><span class="line">    rows.forEach(<span class="function"><span class="params">row</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">const</span> message = {</span><br><span class="line">            <span class="attr">id</span>: row.id,  <span class="comment">// 确保这里保留 id</span></span><br><span class="line">            <span class="attr">text</span>: row.content,</span><br><span class="line">            <span class="attr">deviceName</span>: row.deviceName,</span><br><span class="line">            <span class="attr">ipAddress</span>: row.ipAddress,</span><br><span class="line">            <span class="attr">timestamp</span>: row.timestamp</span><br><span class="line">        };</span><br><span class="line">        <span class="comment">// 将数据库中的数据保存在 messageHistory</span></span><br><span class="line">        messageHistory.push(message);</span><br><span class="line">    });</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"从数据库加载历史消息"</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/send'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> messageContent = req.body.message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (messageContent) {</span><br><span class="line">        <span class="comment">// 存储消息到数据库</span></span><br><span class="line">        db.run(<span class="string">"INSERT INTO messages (content, deviceName, ipAddress, timestamp) VALUES (?, ?, ?, ?)"</span>, [data.text, data.deviceName, clientIpAddress, data.timestamp],</span><br><span class="line">            <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">                <span class="keyword">if</span> (err) {</span><br><span class="line">                    <span class="built_in">console</span>.error(<span class="string">"插入数据库出错:"</span>, err);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'收到的信息:'</span>, data.text || messageContent);</span><br><span class="line">            });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res.status(<span class="number">400</span>).send({<span class="attr">error</span>: <span class="string">"消息内容为空"</span>});</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/socket.io'</span>, express.static(<span class="string">'node_modules/socket.io/client-dist/'</span>));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    res.sendFile(__dirname + <span class="string">'/index.html'</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有一个用户连接'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">formatMessageForEmission</span>(<span class="params">originalMessage</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            ...originalMessage,</span><br><span class="line">            <span class="attr">deviceName</span>: <span class="string">`<span class="subst">${originalMessage.deviceName}</span> (<span class="subst">${originalMessage.ipAddress}</span>)`</span></span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送历史消息给新连接的用户</span></span><br><span class="line">    messageHistory.forEach(<span class="function">(<span class="params">message</span>) =&gt;</span> {</span><br><span class="line">        socket.emit(<span class="string">'receive text'</span>, formatMessageForEmission(message));</span><br><span class="line">        <span class="comment">// console.log("format的设备和IP地址：",message)</span></span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'send text'</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// 获取客户端的IP地址</span></span><br><span class="line">        <span class="keyword">let</span> clientIpAddress = socket.request.connection.remoteAddress.replace(<span class="regexp">/^::ffff:/</span>, <span class="string">''</span>);  <span class="comment">// 清除IPv6前缀</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (clientIpAddress === <span class="string">'::1'</span> || clientIpAddress === <span class="string">'127.0.0.1'</span>) {</span><br><span class="line">            clientIpAddress = <span class="string">'Localhost'</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加ipAddress字段到data对象</span></span><br><span class="line">        data.ipAddress = clientIpAddress;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 默认设备名称</span></span><br><span class="line">        <span class="keyword">if</span> (!data.deviceName || data.deviceName.trim() === <span class="string">""</span>) {</span><br><span class="line">            data.deviceName = <span class="string">"匿名设备"</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加消息发送时间</span></span><br><span class="line">        data.timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加消息到数据库中</span></span><br><span class="line">        db.run(<span class="string">"INSERT INTO messages (content, deviceName, ipAddress, timestamp) VALUES (?, ?, ?, ?)"</span>,</span><br><span class="line">            [data.text, data.deviceName, clientIpAddress, data.timestamp],</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{  <span class="comment">// 使用函数关键字以便访问 this.lastID</span></span><br><span class="line">                <span class="keyword">if</span> (err) {</span><br><span class="line">                    <span class="built_in">console</span>.error(<span class="string">"插入数据库出错:"</span>, err);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                data.id = <span class="built_in">this</span>.lastID;  <span class="comment">// 获取新插入的行的 ID</span></span><br><span class="line">                messageHistory.push(data);  <span class="comment">// 将新消息添加到历史记录</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'通过套接字收到的消息:'</span>, data.text);</span><br><span class="line">            }</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        io.emit(<span class="string">'receive text'</span>, formatMessageForEmission(data));</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'有一个用户断开连接'</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：仅使用一个侦听器，app.listen 或 server.listen</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务器地址：http://localhost:3000'</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = multer.diskStorage({</span><br><span class="line">    <span class="attr">destination</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> {</span><br><span class="line">        cb(<span class="literal">null</span>, <span class="string">'uploads/'</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">filename</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> {</span><br><span class="line">        cb(<span class="literal">null</span>, <span class="built_in">Date</span>.now() + path.extname(file.originalname)) </span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> upload = multer({ <span class="attr">storage</span>: storage });</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/upload-image'</span>, upload.single(<span class="string">'image'</span>), <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">let</span> imageUrl = <span class="string">`/uploads/<span class="subst">${req.file.filename}</span>`</span>;</span><br><span class="line">    res.json({ <span class="attr">text</span>: req.body.text, <span class="attr">deviceName</span>: req.body.deviceName, <span class="attr">imageUrl</span>: imageUrl });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/uploads'</span>, express.static(path.join(__dirname, <span class="string">'uploads'</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态文件处理</span></span><br><span class="line">app.use(<span class="string">'/css'</span>, express.static(path.join(__dirname, <span class="string">'css'</span>)));</span><br><span class="line">app.use(<span class="string">'/js'</span>, express.static(path.join(__dirname, <span class="string">'js'</span>)));</span><br><span class="line">app.use(<span class="string">'/'</span>, express.static(path.join(__dirname, <span class="string">'JetBrainsMono-Regular.ttf'</span>)));</span><br><span class="line">app.use(<span class="string">'/'</span>, express.static(path.join(__dirname, <span class="string">'JetBrainsMono-Regular.woff2'</span>)));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    res.sendFile(path.join(__dirname, <span class="string">'index.html'</span>));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.delete(<span class="string">'/message/:id'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> messageId = req.params.id;</span><br><span class="line">    <span class="keyword">if</span> (messageId) {</span><br><span class="line">        db.run(<span class="string">"DELETE FROM messages WHERE id=?"</span>, [messageId], <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (err) {</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">"从数据库删除消息出错:"</span>, err);</span><br><span class="line">                res.status(<span class="number">500</span>).send({<span class="attr">error</span>: <span class="string">"删除消息失败"</span>});</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从 messageHistory 数组中删除消息</span></span><br><span class="line">            <span class="keyword">const</span> index = messageHistory.findIndex(<span class="function"><span class="params">message</span> =&gt;</span> message.id === <span class="built_in">Number</span>(messageId));</span><br><span class="line">            <span class="keyword">if</span> (index !== -<span class="number">1</span>) {</span><br><span class="line">                messageHistory.splice(index, <span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            res.send({<span class="attr">status</span>: <span class="string">"消息已删除"</span>});</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res.status(<span class="number">400</span>).send({<span class="attr">error</span>: <span class="string">"无效的消息ID"</span>});</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p><strong>启动服务器</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></tbody></table></figure>

<h3 id="0x4-3-直接下载已打包好的"><a href="#0x4-3-直接下载已打包好的" class="headerlink" title="0x4.3 直接下载已打包好的"></a>0x4.3 直接下载已打包好的</h3><p>避免重复上传已打包文件参考：<a class="link" target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1835478-1-1.html">局域网文件和消息传输<i class="fas fa-external-link-alt"></i></a></p>
<p>请确保您具有<a class="link" target="_blank" rel="noopener" href="https://www.52pojie.cn/">吾爱破解<i class="fas fa-external-link-alt"></i></a>的账号，且用户组为<strong>锋芒初露</strong>，本帖的权限设置旨在防止第三方网站未经告知私自获取</p>
<p align="center" style="background-color:#222222; font-size: 2em;"><span style="color:yellow;">要继续学习请往下看</span></p>







<h2 id="0x5-界面图像优化与适配"><a href="#0x5-界面图像优化与适配" class="headerlink" title="0x5 界面图像优化与适配"></a>0x5 界面图像优化与适配</h2><h3 id="0x5-1-消息展示与设备自适应"><a href="#0x5-1-消息展示与设备自适应" class="headerlink" title="0x5.1 消息展示与设备自适应"></a>0x5.1 消息展示与设备自适应</h3><h4 id="0x5-1-1-设备信息消息中心"><a href="#0x5-1-1-设备信息消息中心" class="headerlink" title="0x5.1.1 设备信息消息中心"></a>0x5.1.1 设备信息消息中心</h4><ul>
<li><strong>美化布局</strong>：使用简单的内联CSS让布局居中</li>
<li><strong>显示多条消息</strong>：而不是只覆盖显示一条</li>
<li><strong>显示设备名称/IP</strong>：为简化起见，将让用户输入一个设备名称。关于IP地址，我们可以从请求头中获取</li>
</ul>
<p>更新<code>index.html</code>如下：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Realtime Text<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#f4f4f4</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.container</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"deviceName"</span> <span class="attr">placeholder</span>=<span class="string">"Enter Device Name"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"textArea"</span> <span class="attr">rows</span>=<span class="string">"4"</span> <span class="attr">cols</span>=<span class="string">"50"</span> <span class="attr">placeholder</span>=<span class="string">"Type your message..."</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendButton"</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Received Messages:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"messages"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> socket = io();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'sendButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> deviceName = <span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value || <span class="string">"Unknown"</span>;</span></span><br><span class="line"><span class="javascript">            socket.emit(<span class="string">'send text'</span>, { text, deviceName });</span></span><br><span class="line"><span class="javascript">        };</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        socket.on(<span class="string">'receive text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span></span><br><span class="line"><span class="javascript">            li.innerText = <span class="string">`[<span class="subst">${data.deviceName}</span>]: <span class="subst">${data.text}</span>`</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).appendChild(li);</span></span><br><span class="line"><span class="javascript">        });</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>在<code>server.js</code>中，我们也要做相应的修改以支持新的消息格式并发送设备的IP地址：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a user connected'</span>);</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'send text'</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">let</span> clientIpAddress = socket.request.headers[<span class="string">'x-forwarded-for'</span>] || socket.request.connection.remoteAddress;</span><br><span class="line">        data.ipAddress = clientIpAddress;</span><br><span class="line">        io.emit(<span class="string">'receive text'</span>, data);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'user disconnected'</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>这样，当用户发送消息时，它们将以<code>[DeviceName]: Message</code>的格式显示，并在服务器端的console中记录IP地址。</p>
<p>我们可以在<code>server.js</code>中获取连接的客户端的局域网IP地址，并将其与设备名称一同发送到前端。</p>
<p>首先，修改<code>server.js</code>的消息处理部分以包含IP地址：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a user connected'</span>);</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'send text'</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// 获取客户端的IP地址，清除IPv6前缀，使其更易读</span></span><br><span class="line">        <span class="keyword">let</span> clientIpAddress = socket.request.connection.remoteAddress.replace(<span class="regexp">/^::ffff:/</span>, <span class="string">''</span>);</span><br><span class="line">		<span class="comment">// 如果从运行服务器的同一台机器上连接，将会显示“Localhost”而不是::1或127.0.0.1</span></span><br><span class="line">        <span class="keyword">if</span> (clientIpAddress === <span class="string">'::1'</span> || clientIpAddress === <span class="string">'127.0.0.1'</span>) {</span><br><span class="line">            clientIpAddress = <span class="string">'Localhost'</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 默认设备名称</span></span><br><span class="line">        <span class="keyword">if</span> (!data.deviceName || data.deviceName.trim() === <span class="string">""</span>) {</span><br><span class="line">            data.deviceName = <span class="string">"匿名设备"</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将设备名和IP地址结合在一起</span></span><br><span class="line">        data.deviceName = <span class="string">`<span class="subst">${data.deviceName}</span> (<span class="subst">${clientIpAddress}</span>)`</span>;</span><br><span class="line"></span><br><span class="line">        io.emit(<span class="string">'receive text'</span>, data);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'user disconnected'</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>更新<code>index.html</code>如下：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = io();</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'sendButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value;</span><br><span class="line">    <span class="keyword">var</span> deviceName = <span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value || <span class="string">"匿名设备"</span>;</span><br><span class="line">    socket.emit(<span class="string">'send text'</span>, { text, deviceName });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>现在，在发送消息时，如果用户没有输入设备名称，它将显示为“匿名设备”，并且每个消息都会在设备名称后面带有IP地址。</p>
<p>当用户发送消息时，它们将以 <code>[DeviceName (IP Address)]: Message</code> 的格式显示。</p>
<h4 id="0x5-1-2-iPhone页面自适应"><a href="#0x5-1-2-iPhone页面自适应" class="headerlink" title="0x5.1.2 iPhone页面自适应"></a>0x5.1.2 iPhone页面自适应</h4><p><em>现在我希望在iPhone的浏览器中更好的显示，因为我在iPhone中需要先缩小页面，然后在移动到页面中间再放大才能继续输入消息</em></p>
<p>为了确保页面在移动设备上正常显示，需要添加一个<code>viewport</code>元数据标签来控制页面的缩放。</p>
<p>在<code>index.html</code>文件的<code>&lt;head&gt;</code>部分，添加以下<code>meta</code>标签：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>所以<code>&lt;head&gt;</code>部分现在应该是这样的：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Realtime Text<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#f4f4f4</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">        <span class="selector-class">.container</span> {</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="css">        }</span></span><br><span class="line"><span class="css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>添加此元数据标签后，页面应该会根据设备的屏幕大小自动调整缩放，并且在iPhone等移动设备上应该可以正常显示。</p>
<h3 id="0x5-2-图像优化与传输"><a href="#0x5-2-图像优化与传输" class="headerlink" title="0x5.2  图像优化与传输"></a>0x5.2  图像优化与传输</h3><h4 id="0x5-2-1-图像传输逻辑"><a href="#0x5-2-1-图像传输逻辑" class="headerlink" title="0x5.2.1 图像传输逻辑"></a>0x5.2.1 图像传输逻辑</h4><ol>
<li>在前端添加一个文件输入以选择图片</li>
<li>上传图片到服务器</li>
<li>服务器保存图片并返回一个可访问的URL</li>
<li>在客户端中显示图片</li>
</ol>
<p>修改<code>index.html</code>来添加文件输入，在<code>&lt;div class="container"&gt;</code>内添加一个文件输入：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"imageUpload"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>并修改发送按钮的逻辑来检查是否选择了图片：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'sendButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value;</span><br><span class="line">    <span class="keyword">var</span> deviceName = <span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value || <span class="string">"匿名设备"</span>;</span><br><span class="line">    <span class="keyword">var</span> imageFile = <span class="built_in">document</span>.getElementById(<span class="string">'imageUpload'</span>).files[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imageFile) {</span><br><span class="line">        <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">        formData.append(<span class="string">'image'</span>, imageFile);</span><br><span class="line">        formData.append(<span class="string">'deviceName'</span>, deviceName);</span><br><span class="line">        formData.append(<span class="string">'text'</span>, text);</span><br><span class="line"></span><br><span class="line">        fetch(<span class="string">'/upload-image'</span>, {</span><br><span class="line">            <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">            <span class="attr">body</span>: formData</span><br><span class="line">        }).then(<span class="function"><span class="params">response</span> =&gt;</span> response.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> {</span><br><span class="line">            socket.emit(<span class="string">'send text'</span>, data);</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        socket.emit(<span class="string">'send text'</span>, { text, deviceName });</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p><code>multer</code>在服务器上处理图像上传，它是一个node.js中间件，用于处理<code>multipart/form-data</code>，主要用于上传文件</p>
<p>然后，在<code>server.js</code>中添加以下代码来处理图片上传：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">'multer'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = multer.diskStorage({</span><br><span class="line">    <span class="attr">destination</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> {</span><br><span class="line">        cb(<span class="literal">null</span>, <span class="string">'uploads/'</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">filename</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> {</span><br><span class="line">        cb(<span class="literal">null</span>, <span class="built_in">Date</span>.now() + path.extname(file.originalname)) </span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> upload = multer({ <span class="attr">storage</span>: storage });</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/upload-image'</span>, upload.single(<span class="string">'image'</span>), <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">let</span> imageUrl = <span class="string">`/uploads/<span class="subst">${req.file.filename}</span>`</span>;</span><br><span class="line">    res.json({ <span class="attr">text</span>: req.body.text, <span class="attr">deviceName</span>: req.body.deviceName, <span class="attr">imageUrl</span>: imageUrl });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/uploads'</span>, express.static(path.join(__dirname, <span class="string">'uploads'</span>)));</span><br></pre></td></tr></tbody></table></figure>

<p><strong>确保在服务器目录中创建一个名为<code>uploads</code>的文件夹来存储上传的图片</strong></p>
<p>修改前端显示逻辑，修改<code>socket.on('receive text', ...)</code>逻辑以处理可能的图片消息：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">'receive text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line">    <span class="keyword">var</span> content = <span class="string">`[<span class="subst">${data.deviceName}</span>]: <span class="subst">${data.text}</span>`</span>;</span><br><span class="line">    <span class="keyword">if</span> (data.imageUrl) {</span><br><span class="line">        content += <span class="string">`&lt;br&gt;&lt;img   src="<span class="subst">${data.imageUrl}</span>"  alt="Uploaded image" style="max-width: 300px;"&gt;`</span>;</span><br><span class="line">    }</span><br><span class="line">    li.innerHTML = content;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).appendChild(li);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>现在，应该能够在前端选择图片，上传到服务器，并在接收消息时看到图片显示</p>
<h4 id="0x5-2-2-图片显示与优化"><a href="#0x5-2-2-图片显示与优化" class="headerlink" title="0x5.2.2 图片显示与优化"></a>0x5.2.2 图片显示与优化</h4><p><em>现在我发现在发送多条消息时，发送消息的控件显示在屏幕之外时无法再继续输入消息了</em></p>
<p>这个问题出现的原因是，随着消息的增加，页面内容增长，但浏览器并没有自动滚动以保持输入控件在可见范围内。</p>
<p>为了解决这个问题，我们可以强制页面在添加新消息后滚动到底部。这样，输入框和按钮始终保持在屏幕上的可见范围内</p>
<p>首先更新HTML结构，我们需要对HTML的结构进行一些修改以分离消息列表和输入区域。将输入区域和按钮放入一个固定的底部工具栏中，使其始终位于屏幕底部。</p>
<p>在<code>index.html</code>中<code>&lt;div class="container"&gt;</code>应该更改为以下结构：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"messages"</span> <span class="attr">style</span>=<span class="string">"max-height: 80vh; overflow-y: auto;"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position: fixed; bottom: 0; width: 100%; background-color: white; padding: 10px;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"deviceName"</span> <span class="attr">placeholder</span>=<span class="string">"Device Name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"textArea"</span> <span class="attr">placeholder</span>=<span class="string">"Type your message..."</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"imageUpload"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendButton"</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>上述更改将消息列表的最大高度限制为视口的80%，并为其添加了滚动条。发送消息的工具栏被固定在底部。</p>
<p>添加自动滚动逻辑，在每次添加消息到列表后，执行滚动到底部的逻辑</p>
<p>在<code>socket.on('receive text', ...)</code>的末尾添加以下代码：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).scrollTop = <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).scrollHeight;</span><br></pre></td></tr></tbody></table></figure>

<p>这段代码会将消息列表滚动到最底部，确保新消息总是可见的。</p>
<p>这些更改应该确保无论发送多少消息，输入框和按钮始终保持在屏幕上的可见范围内。</p>
<h5 id="消息多发导致标签被遮挡"><a href="#消息多发导致标签被遮挡" class="headerlink" title="消息多发导致标签被遮挡"></a>消息多发导致标签被遮挡</h5><p>我们需要对HTML和CSS进行调整以确保”Received Messages:”标签始终可见。</p>
<p>以下是如何修改的，修改HTML结构</p>
<p>在<code>index.html</code>中，将”Received Messages:”标签从当前的位置移到工具栏上方，并为其添加一个包围元素：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"header"</span> <span class="attr">style</span>=<span class="string">"background-color: white; padding: 10px;"</span>&gt;</span></span><br><span class="line">        Received Messages:</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"messages"</span> <span class="attr">style</span>=<span class="string">"max-height: 70vh; overflow-y: auto;"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position: fixed; bottom: 0; width: 100%; background-color: white; padding: 10px;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"deviceName"</span> <span class="attr">placeholder</span>=<span class="string">"Device Name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"textArea"</span> <span class="attr">placeholder</span>=<span class="string">"Type your message..."</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"imageUpload"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendButton"</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>调整CSS样式，修改<code>&lt;ul id="messages"&gt;</code>的样式来考虑标题的高度。确保消息列表在标题和工具栏之间：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#messages</span> {</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">max-height</span>: <span class="number">70vh</span>;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这些更改应该确保”Received Messages:”标签不会被挡住，并且在添加消息时，列表仍然会正确滚动。</p>
<h3 id="0x5-3-iPhone界面与交互优化"><a href="#0x5-3-iPhone界面与交互优化" class="headerlink" title="0x5.3 iPhone界面与交互优化"></a>0x5.3 iPhone界面与交互优化</h3><h4 id="0x5-3-1-点击图片放大原尺寸"><a href="#0x5-3-1-点击图片放大原尺寸" class="headerlink" title="0x5.3.1 点击图片放大原尺寸"></a>0x5.3.1 点击图片放大原尺寸</h4><p>为了实现图片点击放大的效果，可以使用一个简单的模态窗口（modal）。当用户点击图片时，模态窗口会显示，并且在其中展示原始尺寸的图片。当用户点击模态窗口之外的任何位置或按下Esc键时，模态窗口会关闭。</p>
<p>在 <code>index.html</code> 的 <code>&lt;body&gt;</code> 末尾添加模态窗口的HTML结构：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Image Modal --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"imageModal"</span> <span class="attr">style</span>=<span class="string">"display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"modalImage"</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"max-width: 90%; max-height: 90%;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>添加显示和关闭模态窗口的逻辑，在现有的JavaScript代码下添加以下代码：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>{</span><br><span class="line">    <span class="comment">// If an image inside the messages is clicked</span></span><br><span class="line">    <span class="keyword">if</span> (event.target.tagName === <span class="string">'IMG'</span> &amp;&amp; event.target.closest(<span class="string">'#messages'</span>)) {</span><br><span class="line">        <span class="keyword">var</span> modal = <span class="built_in">document</span>.getElementById(<span class="string">'imageModal'</span>);</span><br><span class="line">        <span class="keyword">var</span> modalImage = <span class="built_in">document</span>.getElementById(<span class="string">'modalImage'</span>);</span><br><span class="line"></span><br><span class="line">        modalImage.src = event.target.src;</span><br><span class="line">        modal.style.display = <span class="string">'flex'</span>;</span><br><span class="line"></span><br><span class="line">        modal.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">            modal.style.display = <span class="string">'none'</span>;</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// Close modal on pressing 'Escape'</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'keydown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>{</span><br><span class="line">    <span class="keyword">if</span> (event.key === <span class="string">'Escape'</span>) {</span><br><span class="line">        <span class="keyword">var</span> modal = <span class="built_in">document</span>.getElementById(<span class="string">'imageModal'</span>);</span><br><span class="line">        modal.style.display = <span class="string">'none'</span>;</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>这些代码首先会检查是否点击了消息列表中的图片。如果是，则显示模态窗口并设置图片的源。点击模态窗口的任何位置都会关闭它。如果按下’Escape’键，也会关闭模态窗口。</p>
<p>现在，当点击图片时，应该能够在模态窗口中放大显示图片，而点击模态窗口的任何位置或按下Esc键都会关闭它。</p>
<h4 id="0x5-3-2-iPhone浏览器send按钮超屏"><a href="#0x5-3-2-iPhone浏览器send按钮超屏" class="headerlink" title="0x5.3.2 iPhone浏览器send按钮超屏"></a>0x5.3.2 iPhone浏览器send按钮超屏</h4><p>这个问题可能是由于固定底部工具栏的内容太多或样式设置不合适，在某些屏幕尺寸或设备上导致了溢出。为了解决这个问题，我们需要对工具栏的布局和样式进行调整，确保在较小的屏幕上也能适应。</p>
<p>我们可以采用以下策略：</p>
<ol>
<li>将输入框和发送按钮放在一行。</li>
<li>调整宽度和样式以适应不同的屏幕尺寸。</li>
<li>使用flex布局简化样式和布局。</li>
</ol>
<p>更新HTML结构，在<code>index.html</code>中，将工具栏部分修改为：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position: fixed; bottom: 0; width: 100%; background-color: white; padding: 5px; box-shadow: 0 -2px 5px rgba(0,0,0,0.1);"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"display: flex; align-items: center;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"deviceName"</span> <span class="attr">placeholder</span>=<span class="string">"Device Name"</span> <span class="attr">style</span>=<span class="string">"flex: 1; margin-right: 5px;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"imageUpload"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span> <span class="attr">style</span>=<span class="string">"margin-right: 5px;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"textArea"</span> <span class="attr">placeholder</span>=<span class="string">"Type your message..."</span> <span class="attr">style</span>=<span class="string">"flex: 2; margin-right: 5px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendButton"</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>调整样式，确保每个元素都有合适的宽度和间距，使其适应小屏幕。这里，我们使用了<code>flex</code>布局，让<code>deviceName</code>和<code>textArea</code>元素根据剩余空间动态调整其宽度。</p>
<p>现在，工具栏应该能够更好地适应较小的屏幕，如iPhone的浏览器，并且发送按钮应该始终可见和可用。可能需要根据实际设备和屏幕尺寸进行进一步的微调。</p>
<h4 id="0x5-3-3-iPhone输入框超出屏幕"><a href="#0x5-3-3-iPhone输入框超出屏幕" class="headerlink" title="0x5.3.3 iPhone输入框超出屏幕"></a>0x5.3.3 iPhone输入框超出屏幕</h4><p>为了在iPhone的浏览器中获得更好的响应式布局，我们可以采用以下策略：</p>
<ol>
<li>使用媒体查询来针对不同的屏幕尺寸进行样式调整。</li>
<li>在较小的屏幕上，考虑简化布局，可能需要将一些控件移至其他位置。</li>
</ol>
<p>更新HTML结构，在<code>index.html</code>中，继续使用上一个给出的工具栏HTML结构。</p>
<p>添加CSS媒体查询，我们将为小屏幕（如iPhone）添加特定的样式。为此，在的CSS中添加以下内容：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 大屏幕的默认样式 */</span></span><br><span class="line"><span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span> {</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 小屏幕的样式(如iphone) */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="selector-id">#deviceName</span> {</span><br><span class="line">        <span class="attribute">display</span>: none;  <span class="comment">/* 在小屏幕上隐藏设备名称输入 */</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#imageUpload</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">40px</span>; <span class="comment">/* 根据需要调整此值 */</span></span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#textArea</span> {</span><br><span class="line">        <span class="attribute">flex</span>: <span class="number">3</span>;  <span class="comment">/* 给文本区域更多的空间 */</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">flex-shrink</span>: <span class="number">0</span>; <span class="comment">/* 防止按钮收缩 */</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这里的做法是，当屏幕宽度小于或等于500px时（可以根据需要调整此值），隐藏了<code>deviceName</code>输入框以节省空间，并给予<code>textArea</code>更多的空间。此外，还调整了上传按钮和发送按钮的尺寸和样式，以更好地适应小屏幕。</p>
<p>这些调整应该会改进iPhone浏览器上的布局，使其更加友好，可能需要根据实际设备和屏幕尺寸进行进一步的微调</p>
<h4 id="0x5-3-4-iPhone按钮输入框重叠修正"><a href="#0x5-3-4-iPhone按钮输入框重叠修正" class="headerlink" title="0x5.3.4 iPhone按钮输入框重叠修正"></a>0x5.3.4 iPhone按钮输入框重叠修正</h4><p>为了实现这个目标，我们需要对较小屏幕的布局进行改进，使其变为多行排列。</p>
<p>更新HTML结构，在<code>index.html</code>中，继续使用上一个给出的工具栏HTML结构。</p>
<p>调整CSS媒体查询以实现多行排列布局，我们将在小屏幕上采用多行排列布局。添加或修改以下CSS代码：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 大屏幕的默认样式 */</span></span><br><span class="line"><span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span> {</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 小屏幕的样式(如iphone) */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="comment">/* 对于较小的屏幕，将伸缩方向更改为列 */</span></span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> &gt; <span class="selector-tag">div</span> {</span><br><span class="line">        <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#deviceName</span> {</span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#imageUpload</span> {</span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">0</span>; <span class="comment">/* 重置margin-right */</span></span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>; </span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#textArea</span> {</span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">0</span>; <span class="comment">/* 重置margin-right */</span></span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>; </span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>; <span class="comment">/* 留出一点间距 */</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这样的改变会使得在小屏幕上，设备名称、图片上传、文本输入框和发送按钮都单独占据一行，而不会相互重叠。这应该会在iPhone上提供更好的用户体验</p>
<h4 id="0x5-3-5-iPhone布局对齐与点击优化"><a href="#0x5-3-5-iPhone布局对齐与点击优化" class="headerlink" title="0x5.3.5 iPhone布局对齐与点击优化"></a>0x5.3.5 iPhone布局对齐与点击优化</h4><p><strong>更新媒体查询</strong></p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 小屏幕的样式(如iphone) */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="comment">/* 对于较小的屏幕，将伸缩方向更改为列 */</span></span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> &gt; <span class="selector-tag">div</span> {</span><br><span class="line">        <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span> {</span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">0</span>; <span class="comment">/* 重置margin-right */</span></span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;  <span class="comment">/* 全宽 */</span></span><br><span class="line">        <span class="attribute">height</span>: <span class="number">50px</span>; <span class="comment">/* 增加高度，便于触摸 */</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#imageUpload</span> {</span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">0</span>; <span class="comment">/* 重置margin-right */</span></span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>; </span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 全宽 */</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 全宽 */</span></span><br><span class="line">        <span class="attribute">height</span>: <span class="number">50px</span>; <span class="comment">/* 增加高度，便于触摸 */</span></span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>; <span class="comment">/* 留出一点间距 */</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这些调整会使得在小屏幕上，每一个元素都占满了整个屏幕宽度，并且增大了输入框和按钮的高度，以便用户更容易地进行触摸操作。</p>
<p>这应该会提供更好的用户体验，特别是考虑到iPhone和其他移动设备上的拇指操作。可能还需要根据实际设备和需求进行进一步的微调。</p>
<h4 id="0x5-3-6-控件边缘重叠与iPhone点击"><a href="#0x5-3-6-控件边缘重叠与iPhone点击" class="headerlink" title="0x5.3.6 控件边缘重叠与iPhone点击"></a>0x5.3.6 控件边缘重叠与iPhone点击</h4><ol>
<li>控件与屏幕边缘的间距问题</li>
<li>iPhone上首次加载时的交互问题</li>
</ol>
<p><strong>设置控件与屏幕边缘的间距</strong></p>
<p>为了增加边距，可以为工具栏内部的元素添加适当的间距。在的CSS中，可以添加或修改以下样式：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 为固定底部工具栏添加填充 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ... (CSS的其余部分) */</span></span><br></pre></td></tr></tbody></table></figure>

<p>这会为底部工具栏的左右两侧增加10px的间距。可以根据需要调整这个值</p>
<p><strong>iPhone上首次加载时的交互问题</strong></p>
<p>iPhone上的Safari浏览器和其他移动浏览器有一个常见的问题，即当页面首次加载时，固定的元素可能不会响应触摸事件。这是因为浏览器的地址栏和底部工具栏可能会覆盖页面的部分内容。通常，通过滚动页面可以暂时解决这个问题。</p>
<p>为了解决这个问题，可以尝试在页面首次加载时自动滚动页面一小段距离，这样可以确保底部工具栏不会被浏览器的界面元素覆盖。以下是如何实现：</p>
<p>在<code>index.html</code>的<code>&lt;script&gt;</code>标签内部，添加以下JavaScript代码：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    }, <span class="number">0</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>上述代码会在页面加载完成后，立即将页面向上滚动1px。这样可以确保底部的固定工具栏不会被浏览器的界面元素覆盖，并且应该可以响应用户的触摸事件</p>
<h4 id="0x5-3-7-iPhone上两侧间距问题"><a href="#0x5-3-7-iPhone上两侧间距问题" class="headerlink" title="0x5.3.7 iPhone上两侧间距问题"></a>0x5.3.7 iPhone上两侧间距问题</h4><p>对于在iPhone上的边距问题，我们需要更具体地处理与小屏幕或特定设备相关的CSS样式。</p>
<p>下面是如何更具体地针对较小屏幕（如iPhone）设置边距：</p>
<p>首先，确保已经使用了适当的元数据标签来控制视口。在的HTML文件的<code>&lt;head&gt;</code>部分，添加以下标签：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>这会确保页面的宽度匹配设备的宽度，并且页面的初始缩放级别是1.0。</p>
<p>接下来，修改的CSS媒体查询以增加边距。将下面的代码添加或合并到的CSS中：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 大屏幕的默认样式 */</span></span><br><span class="line"><span class="comment">/* ... (你现在的样式) */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 小屏幕的样式(如iphone) */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="comment">/* ... (你当前的小屏幕风格) */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 为整个底部工具栏添加填充 */</span></span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>; <span class="comment">/* 这将在左右两边添加10px的内边距 */</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>通过添加这些更改，iPhone上的边距应该会生效，并且页面内容会根据设备的屏幕宽度适当地调整。</p>
<h4 id="0x5-3-8-iPhone输入框宽度异常"><a href="#0x5-3-8-iPhone输入框宽度异常" class="headerlink" title="0x5.3.8 iPhone输入框宽度异常"></a>0x5.3.8 iPhone输入框宽度异常</h4><p>这个问题可能是由于<code>padding</code>和<code>width: 100%</code>的组合引起的。当我们为一个元素同时设置了<code>padding</code>和<code>width: 100%</code>时，该元素的总宽度会超过其父元素的宽度，因为这里的宽度是指内容宽度，而不包括边距、边框或内边距。</p>
<p>为了解决这个问题，可以使用<code>box-sizing</code>属性，将其设置为<code>border-box</code>，这样元素的总宽度将包括内容、内边距和边框（但不包括外边距）。</p>
<ol>
<li>保证边距。</li>
<li>使用<code>flexbox</code>来确保子元素在小屏幕上垂直排列。</li>
</ol>
<p>在CSS中，找到与小屏幕相关的媒体查询，并进行如下修改：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;     </span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">5px</span>;    </span><br><span class="line">        <span class="attribute">box-sizing</span>: border-box; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">box-sizing</span>: border-box; </span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>; </span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span> {</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">50px</span>; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">50px</span>; </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这些样式应该确保了在小屏幕设备上，特别是iPhone上，所有的控件都正常排列，并且有足够的边距。</p>
<h4 id="0x5-3-9-iPhone布局校验与滑动优化"><a href="#0x5-3-9-iPhone布局校验与滑动优化" class="headerlink" title="0x5.3.9 iPhone布局校验与滑动优化"></a>0x5.3.9 iPhone布局校验与滑动优化</h4><ol>
<li><strong>控件应该按照一行行排列</strong>: 这需要调整底部控件的样式。当前的代码中已经使用了<code>flex-direction: column</code>，这是正确的，但的底部控件的子控件仍然在一个flex容器中，这使得它们在同一行上。需要分离它们以使它们在单独的行上。</li>
<li><strong>两侧与屏幕保持10px的间距</strong>: 可以在底部控件中设置<code>padding-left</code>和<code>padding-right</code>为<code>10px</code>。</li>
<li><strong>第一次打开页面需要滚动一小段距离</strong>: 已经有了这个功能，使用<code>window.scrollTo(0, 1)</code>在页面加载时向下滚动。这通常用于隐藏浏览器的地址栏，但在最新版本的iOS中可能不起作用。</li>
</ol>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ... 现有的样式 ... */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="comment">/* ... 其他样式 ... */</span></span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span><br><span class="line">        <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">        <span class="attribute">flex-direction</span>: column;  </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>; </span><br><span class="line">        <span class="attribute">box-sizing</span>: border-box; </span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;  </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ... 现有的HTML ... --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 调整底部工具栏结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"position: fixed; bottom: 0; width: 100%; background-color: white; padding: 5px; box-shadow: 0 -2px 5px rgba(0,0,0,0.1);"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"deviceName"</span> <span class="attr">placeholder</span>=<span class="string">"Device Name"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"imageUpload"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"textArea"</span> <span class="attr">placeholder</span>=<span class="string">"Type your message..."</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendButton"</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="0x5-3-A-iPhone布局遮挡与间距修正"><a href="#0x5-3-A-iPhone布局遮挡与间距修正" class="headerlink" title="0x5.3.A iPhone布局遮挡与间距修正"></a>0x5.3.A iPhone布局遮挡与间距修正</h4><ol>
<li><strong>两侧控件的距离问题</strong>: 如果右侧和屏幕之间的距离是10px，但左侧并非如此，可能是某些样式或其他浏览器默认样式干扰了。可以考虑为每个子控件设置<code>margin-left</code>和<code>margin-right</code>，以确保他们都有正确的边距。</li>
<li><strong>图片消息被底部的输入框挡住</strong>: 一个常见的方法是为消息列表添加底部内边距，该边距的高度与底部工具栏的高度相同，这样最后一条消息（无论是文本还是图片）都可以完全滚动到视图中而不被挡住。</li>
</ol>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ... 其他样式 ... */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="comment">/* ... 其他样式 ... */</span></span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="comment">/* ... 现有的其他样式 ... */</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#messages</span> {</span><br><span class="line">        <span class="attribute">padding-bottom</span>: <span class="number">70px</span>; </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="0x5-4-消息发送与设备名自动填充"><a href="#0x5-4-消息发送与设备名自动填充" class="headerlink" title="0x5.4 消息发送与设备名自动填充"></a>0x5.4 消息发送与设备名自动填充</h3><h4 id="0x5-4-1-发送后清除已选图像"><a href="#0x5-4-1-发送后清除已选图像" class="headerlink" title="0x5.4.1 发送后清除已选图像"></a>0x5.4.1 发送后清除已选图像</h4><p>为了在发送完消息后清除上次选择的图像，可以在发送消息的函数中清除 <code>&lt;input type="file"&gt;</code> 的值。这将重置文件输入，并确保下次用户点击发送按钮时不会再次发送同一张图片。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'sendButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value;</span><br><span class="line">    <span class="keyword">var</span> deviceName = <span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value || <span class="string">"匿名设备"</span>;</span><br><span class="line">    <span class="keyword">var</span> imageFile = <span class="built_in">document</span>.getElementById(<span class="string">'imageUpload'</span>).files[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imageFile) {</span><br><span class="line">        <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">        formData.append(<span class="string">'image'</span>, imageFile);</span><br><span class="line">        formData.append(<span class="string">'deviceName'</span>, deviceName);</span><br><span class="line">        formData.append(<span class="string">'text'</span>, text);</span><br><span class="line"></span><br><span class="line">        fetch(<span class="string">'/upload-image'</span>, {</span><br><span class="line">            <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">            <span class="attr">body</span>: formData</span><br><span class="line">        }).then(<span class="function"><span class="params">response</span> =&gt;</span> response.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> {</span><br><span class="line">            socket.emit(<span class="string">'send text'</span>, data);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 在此处清除文件输入的值</span></span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'imageUpload'</span>).value = <span class="string">""</span>;</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        socket.emit(<span class="string">'send text'</span>, { text, deviceName });</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>以上的修改确保了每次发送图像消息后，文件输入都会被清除。这样，用户在发送下一条消息时，之前选择的图片不会再次被发送</p>
<h4 id="0x5-4-2-自动填充设备名称"><a href="#0x5-4-2-自动填充设备名称" class="headerlink" title="0x5.4.2 自动填充设备名称"></a>0x5.4.2 自动填充设备名称</h4><p>为了自动获取设备名称，首先需要明确一个事实：Web 浏览器出于隐私和安全的考虑，并不允许直接获取设备的真实名称。但是，可以使用一些方法来近似识别或标识设备，例如使用浏览器的用户代理字符串。</p>
<p>用户代理 (User Agent) 字符串包含关于浏览器、操作系统和设备的信息，可以通过这些信息来推断或标识用户的设备类型</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDeviceNameFromUserAgent</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> userAgent = navigator.userAgent || navigator.vendor || <span class="built_in">window</span>.opera;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Windows Phone必须先行一步，因为它的用户界面也包含“Android”。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/windows phone/i</span>.test(userAgent)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Windows Phone"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/android/i</span>.test(userAgent)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Android Device"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// iOS检测</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/iPad|iPhone|iPod/</span>.test(userAgent) &amp;&amp; !<span class="built_in">window</span>.MSStream) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"iOS Device"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/macintosh|mac os x/i</span>.test(userAgent)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Mac"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/windows/i</span>.test(userAgent)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Windows PC"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Unknown Device"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用函数来自动填充设备名称</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value = getDeviceNameFromUserAgent();</span><br></pre></td></tr></tbody></table></figure>

<p>此函数根据用户代理字符串来近似地识别设备，并返回一个描述性名称。注意，这只是一个基本的示例，而真实的环境中可能需要更复杂的逻辑来准确识别设备。</p>
<p>这种方法只是提供了一个近似的设备名称，并不能真正的识别具体的设备型号或品牌</p>
<h4 id="0x5-4-3-消息发送后自动清空输入框"><a href="#0x5-4-3-消息发送后自动清空输入框" class="headerlink" title="0x5.4.3 消息发送后自动清空输入框"></a>0x5.4.3 消息发送后自动清空输入框</h4><p>为了在发送完消息后自动清除 <code>textArea</code> （你之前的代码中使用这个ID代表消息输入框）中的值，你可以在发送消息的函数中添加一行代码来实现这个功能</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'sendButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> text = <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value;</span><br><span class="line">    <span class="keyword">var</span> deviceName = <span class="built_in">document</span>.getElementById(<span class="string">'deviceName'</span>).value || <span class="string">"匿名设备"</span>;</span><br><span class="line">    <span class="keyword">var</span> imageFile = <span class="built_in">document</span>.getElementById(<span class="string">'imageUpload'</span>).files[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果选择了图片，则发送图片</span></span><br><span class="line">    <span class="keyword">if</span> (imageFile) {</span><br><span class="line">        <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">        formData.append(<span class="string">'image'</span>, imageFile);</span><br><span class="line">        formData.append(<span class="string">'deviceName'</span>, deviceName);</span><br><span class="line">        formData.append(<span class="string">'text'</span>, text);</span><br><span class="line"></span><br><span class="line">        fetch(<span class="string">'/upload-image'</span>, {</span><br><span class="line">            <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">            <span class="attr">body</span>: formData</span><br><span class="line">        }).then(<span class="function"><span class="params">response</span> =&gt;</span> response.json()).then(<span class="function"><span class="params">data</span> =&gt;</span> {</span><br><span class="line">            socket.emit(<span class="string">'send text'</span>, data);</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// 如果没有选择图片，则直接发送文本消息</span></span><br><span class="line">        socket.emit(<span class="string">'send text'</span>, { text, deviceName });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在所有情况下都清除textArea和图片选择器的值</span></span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'textArea'</span>).value = <span class="string">''</span>;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'imageUpload'</span>).value = <span class="string">''</span>;  <span class="comment">// 这将清除文件输入选择器的内容</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>我在函数的底部添加了清除<code>textArea</code>和图片选择器<code>imageUpload</code>的代码。这样，无论是否选择了图片，都会在发送完消息后清除文本框和图片选择器的内容。</p>
<h3 id="0x5-5-大屏适配与控件布局调整"><a href="#0x5-5-大屏适配与控件布局调整" class="headerlink" title="0x5.5 大屏适配与控件布局调整"></a>0x5.5 大屏适配与控件布局调整</h3><h4 id="0x5-5-1-Windows居中-iPhone逐行"><a href="#0x5-5-1-Windows居中-iPhone逐行" class="headerlink" title="0x5.5.1 Windows居中 iPhone逐行"></a>0x5.5.1 Windows居中 iPhone逐行</h4><p>修改CSS以在大屏幕上对底部控件进行水平居中：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bottom-controls</span> {</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center; <span class="comment">/* 内容器水平居中 */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bottom-controls</span> &gt; <span class="selector-tag">div</span> {</span><br><span class="line">    <span class="attribute">display</span>: flex; <span class="comment">/* 这确保了内部容器的子元素水平对齐 */</span></span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ... 其他样式 ... */</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>使用媒体查询来特定地为小屏幕（例如iPhone）定义样式：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 小屏幕的样式(如iphone) */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">    <span class="selector-class">.bottom-controls</span> {</span><br><span class="line">        <span class="attribute">justify-content</span>: flex-start; <span class="comment">/* 这将使内部容器与起始位置对齐 */</span></span><br><span class="line">    }</span><br><span class="line">    <span class="selector-class">.bottom-controls</span> &gt; <span class="selector-tag">div</span> {</span><br><span class="line">        <span class="attribute">flex-direction</span>: column; <span class="comment">/* 这确保了内部容器的子容器是垂直堆叠的 */</span></span><br><span class="line">        <span class="attribute">align-items</span>: center;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 确保控件在小屏幕上占满宽度 */</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* ... 你的其他小屏幕风格 ... */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这样，底部的控件在大屏幕上会水平居中，而在小屏幕（如iPhone）上，则会按照行排列。</p>
<h4 id="0x5-5-2-扩大大屏幕底部控件尺寸"><a href="#0x5-5-2-扩大大屏幕底部控件尺寸" class="headerlink" title="0x5.5.2 扩大大屏幕底部控件尺寸"></a>0x5.5.2 扩大大屏幕底部控件尺寸</h4><p>为了在大屏幕上使控件更大，可以使用媒体查询来区分大屏幕和小屏幕的样式。在大屏幕的样式中，可以增加控件的高度和字体大小。</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 大屏幕的样式(例如，Windows, MacBook) */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">501px</span>) {</span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">60px</span>; <span class="comment">/* 增加控件的高度 */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">18px</span>; <span class="comment">/* 增加字体大小以获得更好的可视性 */</span></span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="comment">/* 为美观添加一些填充 */</span></span><br><span class="line">    }</span><br><span class="line">    <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>; <span class="comment">/* 调整按钮的填充 */</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这段代码将确保在宽度超过501px的屏幕上，控件的高度、字体大小和内部间距都增加了，从而更适合大屏幕使用。可以根据实际需要进一步调整这些值。</p>
<h4 id="0x5-5-3-大屏幕输入框长度及控件间距"><a href="#0x5-5-3-大屏幕输入框长度及控件间距" class="headerlink" title="0x5.5.3 大屏幕输入框长度及控件间距"></a>0x5.5.3 大屏幕输入框长度及控件间距</h4><p>为了在大屏幕上调整输入框的长度并在输入框和按钮之间添加合适的距离，可以进行以下修改：</p>
<ol>
<li>在大屏幕上为输入框和按钮添加合适的间距</li>
<li>为大屏幕上的输入框增加宽度</li>
</ol>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 大屏幕的样式(例如，Windows, MacBook) */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">501px</span>) {</span><br><span class="line">    <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">60px</span>; </span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">18px</span>; </span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">10px</span>; </span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">10px</span>; </span><br><span class="line">    }</span><br><span class="line">    <span class="selector-id">#sendButton</span> {</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>; </span><br><span class="line">    }</span><br><span class="line">    <span class="selector-id">#textArea</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">60%</span>; </span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* 可以移除伸缩容器中最后一个元素的右距 */</span></span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> &gt; <span class="selector-tag">div</span> &gt; *<span class="selector-pseudo">:last-child</span> {</span><br><span class="line">        <span class="attribute">margin-right</span>: <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这段代码增加了<code>#textArea</code>的宽度并在所有底部控件之间添加了<code>margin-right</code>。为了确保最后一个元素（按钮）不与其父元素的右边界有太大的间隔，我添加了一个特定选择器来移除其右边距</p>
<h3 id="0x5-6-增加深浅色主题"><a href="#0x5-6-增加深浅色主题" class="headerlink" title="0x5.6 增加深浅色主题"></a>0x5.6 增加深浅色主题</h3><ol>
<li>在HTML中添加一个切换按钮。</li>
<li>为深色模式定义CSS样式。</li>
<li>使用JavaScript监听按钮点击事件来切换主题。</li>
</ol>
<p>更新<code>index.html</code>如下：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> <span class="selector-tag">input</span>, <span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> <span class="selector-tag">textarea</span>, <span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> <span class="selector-tag">button</span> {</span><br><span class="line">            <span class="attribute">color</span>: white;  <span class="comment">/* 将文字颜色设置为白色 */</span></span><br><span class="line">            <span class="attribute">border-color</span>: white; <span class="comment">/* 如果需要, 也可以设置边框颜色 */</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="selector-pseudo">:root</span> {</span><br><span class="line">            <span class="comment">/* 浅色模式的设置 */</span></span><br><span class="line">            --text-<span class="attribute">color</span>: black;</span><br><span class="line">            --<span class="attribute">background-color</span>: white;</span><br><span class="line">            --<span class="selector-tag">input</span>-bg: <span class="number">#fff</span>;</span><br><span class="line">            --container-bg: <span class="number">#fff</span>;</span><br><span class="line">            --<span class="selector-tag">header</span>-bg: <span class="number">#fff</span>;</span><br><span class="line">            --<span class="selector-tag">button</span>-<span class="attribute">color</span>: black; <span class="comment">/* 新增 */</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> {</span><br><span class="line">            <span class="comment">/* 深色模式的设置 */</span></span><br><span class="line">            --text-<span class="attribute">color</span>: black;  <span class="comment">/* 文本颜色为黑色 */</span></span><br><span class="line">            --<span class="attribute">background-color</span>: white;  <span class="comment">/* 背景颜色为白色 */</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.bottom-controls</span> {</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: center; </span><br><span class="line">        }</span><br><span class="line">        <span class="selector-class">.bottom-controls</span> &gt; <span class="selector-tag">div</span> {</span><br><span class="line">            <span class="attribute">display</span>: flex; </span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/* 为固定底部工具栏添加填充 */</span></span><br><span class="line">        <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span><br><span class="line">          <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">          <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/* 保证body的背景颜色被应用 */</span></span><br><span class="line">        <span class="selector-tag">body</span> {</span><br><span class="line">            <span class="attribute">font-family</span>: Arial, sans-serif;</span><br><span class="line">            <span class="attribute">display</span>: flex;</span><br><span class="line">            <span class="attribute">justify-content</span>: center;</span><br><span class="line">            <span class="attribute">align-items</span>: center;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--background-color) <span class="meta">!important</span>; </span><br><span class="line">            <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">            <span class="attribute">font-family</span>: <span class="string">"JetBrainsMono"</span>, Arial, sans-serif;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/* 如果有特定的元素想要应用不同的文本或背景颜色，可以为它们单独设置： */</span></span><br><span class="line">        <span class="selector-class">.element</span> {</span><br><span class="line">            <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--background-color);</span><br><span class="line">        }</span><br><span class="line">        <span class="selector-class">.container</span> {</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/* 小屏幕的样式(如iphone) */</span></span><br><span class="line">        <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) {</span><br><span class="line">          <span class="selector-class">.bottom-controls</span> {</span><br><span class="line">              <span class="attribute">justify-content</span>: flex-start; </span><br><span class="line">          }</span><br><span class="line">          <span class="selector-class">.bottom-controls</span> &gt; <span class="selector-tag">div</span> {</span><br><span class="line">              <span class="attribute">flex-direction</span>: column; </span><br><span class="line">              <span class="attribute">align-items</span>: center;</span><br><span class="line">              <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 更新底部控件的容器样式 */</span></span><br><span class="line">          <span class="selector-tag">div</span><span class="selector-attr">[style*=<span class="string">"position: fixed; bottom: 0;"</span>]</span> {</span><br><span class="line">              <span class="attribute">background-color</span>: <span class="built_in">var</span>(--container-bg);</span><br><span class="line"></span><br><span class="line">              <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">              <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">              <span class="attribute">display</span>: flex;</span><br><span class="line">              <span class="attribute">flex-direction</span>: column; </span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* 确保所有控件拉伸以填充可用宽度 */</span></span><br><span class="line">          <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">              <span class="attribute">background-color</span>: <span class="built_in">var</span>(--container-bg);</span><br><span class="line"></span><br><span class="line">              <span class="attribute">width</span>: <span class="number">100%</span>; </span><br><span class="line">              <span class="attribute">box-sizing</span>: border-box; </span><br><span class="line">              <span class="attribute">margin-bottom</span>: <span class="number">5px</span>;  </span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* 增加高度，便于触摸 */</span></span><br><span class="line">          <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">              <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">          }</span><br><span class="line">          <span class="comment">/* 在邮件列表的底部添加填充 */</span></span><br><span class="line">          <span class="selector-id">#messages</span> {</span><br><span class="line">              <span class="attribute">padding-bottom</span>: <span class="number">70px</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/* 大屏幕的样式(例如，Windows, MacBook) */</span></span><br><span class="line">        <span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">501px</span>) {</span><br><span class="line">            <span class="selector-id">#deviceName</span>, <span class="selector-id">#textArea</span>, <span class="selector-id">#imageUpload</span>, <span class="selector-id">#sendButton</span> {</span><br><span class="line">                <span class="attribute">background-color</span>: <span class="built_in">var</span>(--input-bg);</span><br><span class="line"></span><br><span class="line">                <span class="attribute">height</span>: <span class="number">60px</span>; </span><br><span class="line">                <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">10px</span>; </span><br><span class="line">                <span class="attribute">margin-bottom</span>: <span class="number">10px</span>; </span><br><span class="line">            }</span><br><span class="line">            <span class="selector-id">#textArea</span> {</span><br><span class="line">                <span class="attribute">width</span>: <span class="number">50%</span>; </span><br><span class="line">            }</span><br><span class="line">            <span class="selector-id">#sendButton</span> {</span><br><span class="line">                <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">                <span class="attribute">margin-left</span>: <span class="number">10px</span>; </span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="selector-tag">body</span>, <span class="selector-tag">button</span> {</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">            <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/* 为了确保按钮的文本颜色能够在两种主题下都清晰可见 */</span></span><br><span class="line">        <span class="selector-tag">button</span> {</span><br><span class="line">            <span class="attribute">color</span>: <span class="built_in">var</span>(--button-color);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/* 底部控件的文本颜色 */</span></span><br><span class="line">        <span class="selector-class">.bottom-controls</span> <span class="selector-tag">input</span>, </span><br><span class="line">        <span class="selector-class">.bottom-controls</span> <span class="selector-tag">textarea</span>, </span><br><span class="line">        <span class="selector-class">.bottom-controls</span> <span class="selector-tag">button</span> {</span><br><span class="line">            <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">            <span class="attribute">border-color</span>: <span class="built_in">var</span>(--text-color); </span><br><span class="line">        }</span><br><span class="line">        <span class="selector-class">.container</span> {</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--container-bg);</span><br><span class="line">        }</span><br><span class="line">        <span class="selector-tag">body</span><span class="selector-class">.dark-theme</span> {</span><br><span class="line">            <span class="comment">/* 深色模式的设置 */</span></span><br><span class="line">            --text-<span class="attribute">color</span>: white;</span><br><span class="line">            --<span class="attribute">background-color</span>: <span class="number">#555</span>;</span><br><span class="line">            --<span class="selector-tag">input</span>-bg: <span class="number">#555</span>;</span><br><span class="line">            --container-bg: <span class="number">#444</span>;</span><br><span class="line">            --<span class="selector-tag">header</span>-bg: <span class="number">#444</span>;</span><br><span class="line">            --<span class="selector-tag">button</span>-<span class="attribute">color</span>: white; <span class="comment">/* 新增 */</span></span><br><span class="line">        }</span><br><span class="line">        <span class="selector-id">#header</span> {</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="built_in">var</span>(--header-bg);</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切换主题</span></span><br><span class="line">   <span class="built_in">document</span>.getElementById(<span class="string">'themeToggle'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">       <span class="built_in">document</span>.body.classList.toggle(<span class="string">'dark-theme'</span>);</span><br><span class="line">   });</span><br></pre></td></tr></tbody></table></figure>

<p>现在，当点击”Toggle Theme”按钮，页面的主题应该会在深色和浅色模式之间切换，并且文本应该会根据相应的模式改变颜色。</p>
<h2 id="0x6-导入自定义字体"><a href="#0x6-导入自定义字体" class="headerlink" title="0x6 导入自定义字体"></a>0x6 导入自定义字体</h2><ol>
<li><strong>选择字体</strong>: 首先，需要一个字体文件。这可以是<code>.ttf</code>、<code>.woff</code>、<code>.woff2</code>、<code>.eot</code>等格式。确保拥有使用该字体的权利，特别是如果打算在商业项目中使用。</li>
<li><strong>字体文件上传</strong>: 将字体文件上传到的服务器或CDN，并确保知道文件的URL。</li>
<li><strong>在CSS中导入字体</strong>: 在CSS文件或<code>&lt;style&gt;</code>标签中，使用<code>@font-face</code>规则来定义和导入字体。</li>
</ol>
<p>下载<a class="link" target="_blank" rel="noopener" href="https://www.jetbrains.com/lp/mono/">JetBrains Mono<i class="fas fa-external-link-alt"></i></a>字体，解压<code>JetBrainsMono-Regular.ttf</code>、<code>JetBrainsMono-Regular.woff2</code>到网站根目录</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> {</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">"JetBrainsMono"</span>; <span class="comment">/* 可以为字体起一个名字 */</span></span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'JetBrainsMono-Regular.woff2'</span>) <span class="built_in">format</span>(<span class="string">'woff2'</span>), /* 最优先 */</span><br><span class="line">        <span class="built_in">url</span>(<span class="string">'JetBrainsMono-Regular.ttf'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在这里，<code>path-to-your-font</code>应该是字体文件的URL。如果有多种格式的字体文件，列出它们都是一个好主意，因为这可以确保更好的兼容性</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 保证body的背景颜色被应用 */</span></span><br><span class="line"><span class="selector-tag">body</span> {</span><br><span class="line">    <span class="comment">/* ... 其他样式 ... */</span></span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">"JetBrainsMono"</span>, Arial, sans-serif;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在这里，<code>"MyCustomFont"</code>是我们为自定义字体定义的名字，<code>Arial, sans-serif</code>是后备字体，用于在某些情况下（例如，如果自定义字体加载失败）</p>
<p>考虑性能：字体文件可能很大，所以考虑只包括真正需要的字体权重和样式。例如，如果只需要常规和加粗，那么不要加载斜体或其他权重</p>
<h2 id="0x7-添加自动加载历史记录功能"><a href="#0x7-添加自动加载历史记录功能" class="headerlink" title="0x7 添加自动加载历史记录功能"></a>0x7 添加自动加载历史记录功能</h2><p>如果你想添加一个自动加载历史记录的功能，你需要在服务器端存储这些历史消息。这样，当新用户连接时，你就可以将这些历史消息发送给他们。</p>
<p>更新<code>server.js</code>如下：</p>
<p>在服务器上添加一个变量来存储消息</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> messageHistory = [];</span><br></pre></td></tr></tbody></table></figure>

<p>当接收到新的文本消息时，将它添加到历史记录中</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">'send text'</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">    <span class="comment">// ...（其他代码不变）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将消息添加到历史记录</span></span><br><span class="line">    messageHistory.push(data);</span><br><span class="line"></span><br><span class="line">    io.emit(<span class="string">'receive text'</span>, data);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>当新用户连接时，发送所有历史消息给他们</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a user connected'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送历史消息给新连接的用户</span></span><br><span class="line">    messageHistory.forEach(<span class="function">(<span class="params">message</span>) =&gt;</span> {</span><br><span class="line">        socket.emit(<span class="string">'receive text'</span>, message);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...（其他代码不变）</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p><code>index.html</code>在客户端的 JavaScript 里，你不需要做任何修改。因为客户端已经设置了一个监听函数来处理 ‘receive text’ 事件，所以当它接收到历史消息时，会自动将其添加到消息列表。</p>
<p>这样，当有新用户加入聊天时，服务器就会自动发送所有历史消息给他们</p>
<h2 id="0x8-添加消息代码格式化和时间戳"><a href="#0x8-添加消息代码格式化和时间戳" class="headerlink" title="0x8 添加消息代码格式化和时间戳"></a>0x8 添加消息代码格式化和时间戳</h2><p>为了在消息中添加发送时间，可以在服务器端获取当前时间，并将其与其他数据一起发送。同时，也需要在客户端的JavaScript中修改接收数据的部分，以显示这一时间。</p>
<p>首先，在 <code>server.js</code> 的 <code>'send text'</code> 事件处理程序中添加发送时间：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">'send text'</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">    <span class="comment">// ...其它代码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加消息发送时间</span></span><br><span class="line">    data.timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将新消息添加到历史记录</span></span><br><span class="line">    messageHistory.push(data);</span><br><span class="line"></span><br><span class="line">    io.emit(<span class="string">'receive text'</span>, data);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>修改 <code>index.html</code> 在接收消息部分，添加代码格式支持和时间戳</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">'receive text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line">    <span class="keyword">var</span> time = data.timestamp || <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(); <span class="comment">// 获取时间戳，如果没有则使用当前时间</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> content = <span class="string">`[<span class="subst">${data.deviceName}</span> @ <span class="subst">${time}</span>]: `</span>; <span class="comment">// 显示设备名和时间</span></span><br><span class="line">    <span class="keyword">if</span> (data.text.startsWith(<span class="string">"```"</span>) &amp;&amp; data.text.endsWith(<span class="string">"```"</span>)) {</span><br><span class="line">        <span class="comment">// 如果文本以 "```" 开头和结尾，将其识别为代码</span></span><br><span class="line">        content += <span class="string">`&lt;pre&gt;<span class="subst">${data.text.slice(<span class="number">3</span>, -<span class="number">3</span>)}</span>&lt;/pre&gt;`</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        content += <span class="string">`<span class="subst">${data.text}</span>`</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data.imageUrl) {</span><br><span class="line">        content += <span class="string">`&lt;br&gt;&lt;img   src="<span class="subst">${data.imageUrl}</span>"  alt="Uploaded image" style="max-width: 300px;"&gt;`</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    li.innerHTML = content;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).appendChild(li);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>这样，如果用户在 <code>textArea</code> 输入的文本以 **”```”** 开头和结尾，这段文本将会被认为是代码，并用 <code>&lt;pre&gt;</code> 标签进行包裹，以维持其格式。同时，每条消息也会显示发送时间。</p>
<h2 id="0x9-增加消息删除与数据库"><a href="#0x9-增加消息删除与数据库" class="headerlink" title="0x9 增加消息删除与数据库"></a>0x9 增加消息删除与数据库</h2><h3 id="0x9-1-增加消息删除"><a href="#0x9-1-增加消息删除" class="headerlink" title="0x9.1 增加消息删除"></a>0x9.1 增加消息删除</h3><p>创建一个复选框要对应每条消息，所以必须设置每条消息和复选框的ID保持一致，在选择复选框时应该同时删除后面的消息</p>
<p>修改<code>index.html</code>文件</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> messageId = <span class="number">0</span>;  <span class="comment">// 初始化一个全局变量</span></span><br><span class="line">    socket.on(<span class="string">'receive text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{</span><br><span class="line">        <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建复选框</span></span><br><span class="line">        <span class="keyword">var</span> checkbox = <span class="built_in">document</span>.createElement(<span class="string">"input"</span>);</span><br><span class="line">        checkbox.type = <span class="string">"checkbox"</span>;</span><br><span class="line">        checkbox.className = <span class="string">"messageCheckbox"</span>;</span><br><span class="line">        li.appendChild(checkbox);  <span class="comment">// 将复选框添加到列表项中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> time = data.timestamp || <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString(); <span class="comment">// 获取时间戳，如果没有则使用当前时间</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> content = <span class="string">`[<span class="subst">${data.deviceName}</span> @ <span class="subst">${time}</span>]: `</span>; <span class="comment">// 显示设备名和时间</span></span><br><span class="line">        <span class="keyword">if</span> (data.text.startsWith(<span class="string">"```"</span>) &amp;&amp; data.text.endsWith(<span class="string">"```"</span>)) {</span><br><span class="line">            <span class="comment">// 如果文本以 "```" 开头和结尾，将其识别为代码</span></span><br><span class="line">            content += <span class="string">`&lt;pre&gt;<span class="subst">${data.text.slice(<span class="number">3</span>, -<span class="number">3</span>)}</span>&lt;/pre&gt;`</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            content += <span class="string">`<span class="subst">${data.text}</span>`</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (data.imageUrl) {</span><br><span class="line">            content += <span class="string">`&lt;br&gt;&lt;img   src="<span class="subst">${data.imageUrl}</span>"  alt="Uploaded image" style="max-width: 300px;"&gt;`</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        li.innerHTML += content;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'messages'</span>).appendChild(li);</span><br><span class="line"></span><br><span class="line">        li.setAttribute(<span class="string">'data-message-id'</span>, messageId);  <span class="comment">// 为每个消息设置唯一ID</span></span><br><span class="line">        messageId++;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"设备名称和IP地址:"</span>, data.deviceName);</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>

<p>向服务器发送删除请求</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'deleteButton'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> selectedMessages = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.messageCheckbox:checked'</span>);</span><br><span class="line">    <span class="keyword">var</span> messageIdsToDelete = [];</span><br><span class="line">    selectedMessages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">checkbox</span>) </span>{</span><br><span class="line">        <span class="keyword">var</span> li = checkbox.closest(<span class="string">'li'</span>);</span><br><span class="line">        messageIdsToDelete.push(li.getAttribute(<span class="string">'data-message-id'</span>));</span><br><span class="line">        li.remove();</span><br><span class="line">    });</span><br><span class="line">    socket.emit(<span class="string">'delete messages'</span>, messageIdsToDelete);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向后端发送删除请求</span></span><br><span class="line">    messageIdsToDelete.forEach(<span class="function"><span class="params">id</span> =&gt;</span> {</span><br><span class="line">        fetch(<span class="string">`/message/<span class="subst">${id}</span>`</span>, {</span><br><span class="line">            <span class="attr">method</span>: <span class="string">'DELETE'</span></span><br><span class="line">        }).then(<span class="function"><span class="params">response</span> =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (!response.ok) {</span><br><span class="line">                <span class="comment">// 以某种方式处理错误响应</span></span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">'从服务器删除消息失败'</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>向所有客户端广播消息ID，以供删除</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">'delete messages'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">messageIds</span>) </span>{</span><br><span class="line">        messageIds.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">messageId</span>) </span>{</span><br><span class="line">            <span class="keyword">var</span> li = <span class="built_in">document</span>.querySelector(<span class="string">'li[data-message-id="'</span> + messageId + <span class="string">'"]'</span>);</span><br><span class="line">            <span class="keyword">if</span> (li) li.remove();</span><br><span class="line">        });</span><br><span class="line">        io.emit(<span class="string">'delete messages'</span>, messageIds);</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>

<h3 id="0x9-2-前端数据库联动删消息"><a href="#0x9-2-前端数据库联动删消息" class="headerlink" title="0x9.2 前端数据库联动删消息"></a>0x9.2 前端数据库联动删消息</h3><h4 id="0x9-2-1-创建数据库"><a href="#0x9-2-1-创建数据库" class="headerlink" title="0x9.2.1 创建数据库"></a>0x9.2.1 创建数据库</h4><p>修改<code>server.js</code>文件</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="keyword">new</span> sqlite3.Database(<span class="string">'./messages.db'</span>);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0x9-2-2-创建表"><a href="#0x9-2-2-创建表" class="headerlink" title="0x9.2.2 创建表"></a>0x9.2.2 创建表</h4><p>创建message表，如果存在则什么都不做，包含id、content、deviceName、 ipAddress、 timestamp字段</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.run(<span class="string">"CREATE TABLE IF NOT EXISTS messages (id INTEGER PRIMARY KEY AUTOINCREMENT, content TEXT, deviceName TEXT, ipAddress TEXT, timestamp TEXT)"</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">if</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"创建/检查表错误:"</span>, err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"表检查/创建成功"</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0x9-2-3-读取数据库所有消息"><a href="#0x9-2-3-读取数据库所有消息" class="headerlink" title="0x9.2.3 读取数据库所有消息"></a>0x9.2.3 读取数据库所有消息</h4><p>从数据库中查询所有的消息记录，并将每条消息存储到<code>messageHistory</code>数组中，若查询过程中出现错误，会在控制台中打印错误信息</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">db.all(<span class="string">"SELECT id, content, deviceName, ipAddress, timestamp FROM messages"</span>, [], <span class="function">(<span class="params">err, rows</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">if</span> (err) {</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"从数据库获取历史消息出错:"</span>, err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 遍历数据库每条记录</span></span><br><span class="line">    rows.forEach(<span class="function"><span class="params">row</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">const</span> message = {</span><br><span class="line">            <span class="attr">id</span>: row.id,  <span class="comment">// 确保这里保留 id</span></span><br><span class="line">            <span class="attr">text</span>: row.content,</span><br><span class="line">            <span class="attr">deviceName</span>: row.deviceName,</span><br><span class="line">            <span class="attr">ipAddress</span>: row.ipAddress,</span><br><span class="line">            <span class="attr">timestamp</span>: row.timestamp</span><br><span class="line">        };</span><br><span class="line">        <span class="comment">// 将数据库中的数据保存在 messageHistory</span></span><br><span class="line">        messageHistory.push(message);</span><br><span class="line">    });</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"从数据库加载历史消息"</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0x9-2-4-保存前端消息到数据库"><a href="#0x9-2-4-保存前端消息到数据库" class="headerlink" title="0x9.2.4 保存前端消息到数据库"></a>0x9.2.4 保存前端消息到数据库</h4><p>定义了一个HTTP POST路由<code>/send</code>，用于从请求体中接收消息内容，并在消息内容存在时将其存储到数据库中，若消息内容为空，则返回一个错误响应</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/send'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> messageContent = req.body.message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (messageContent) {</span><br><span class="line">        <span class="comment">// 存储消息到数据库</span></span><br><span class="line">        db.run(<span class="string">"INSERT INTO messages (content, deviceName, ipAddress, timestamp) VALUES (?, ?, ?, ?)"</span>, [data.text, data.deviceName, clientIpAddress, data.timestamp],</span><br><span class="line">            <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">                <span class="keyword">if</span> (err) {</span><br><span class="line">                    <span class="built_in">console</span>.error(<span class="string">"插入数据库出错:"</span>, err);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'收到的信息:'</span>, data.text || messageContent);</span><br><span class="line">            });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res.status(<span class="number">400</span>).send({<span class="attr">error</span>: <span class="string">"消息内容为空"</span>});</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0x9-2-5-广播所有消息给用户"><a href="#0x9-2-5-广播所有消息给用户" class="headerlink" title="0x9.2.5 广播所有消息给用户"></a>0x9.2.5 广播所有消息给用户</h4><p>当一个用户与服务器建立Socket连接时的操作：首先打印出用户已连接的消息，然后将存储在<code>messageHistory</code>数组中的每条历史消息（经过修改以显示设备名和IP地址）发送给新连接的用户</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有一个用户连接'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">formatMessageForEmission</span>(<span class="params">originalMessage</span>) </span>{</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            ...originalMessage,</span><br><span class="line">            <span class="attr">deviceName</span>: <span class="string">`<span class="subst">${originalMessage.deviceName}</span> (<span class="subst">${originalMessage.ipAddress}</span>)`</span></span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送历史消息给新连接的用户</span></span><br><span class="line">    messageHistory.forEach(<span class="function">(<span class="params">message</span>) =&gt;</span> {</span><br><span class="line">        socket.emit(<span class="string">'receive text'</span>, formatMessageForEmission(message));</span><br><span class="line">        <span class="comment">// console.log("format的设备和IP地址：",message)</span></span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0x9-2-6-广播Socket客户端消息"><a href="#0x9-2-6-广播Socket客户端消息" class="headerlink" title="0x9.2.6 广播Socket客户端消息"></a>0x9.2.6 广播Socket客户端消息</h4><p>当服务器通过Socket接收到客户端发送的<code>send text</code>事件时，首先获取和处理客户端的IP地址，为没有提供设备名称的消息设置默认名称，然后将消息及相关信息添加到数据库中。之后，会修改消息的设备名称，将新消息添加到历史记录数组，并通过Socket广播这条消息给所有连接的客户端</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">'send text'</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// 获取客户端的IP地址</span></span><br><span class="line">        <span class="keyword">let</span> clientIpAddress = socket.request.connection.remoteAddress.replace(<span class="regexp">/^::ffff:/</span>, <span class="string">''</span>);  <span class="comment">// 清除IPv6前缀</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (clientIpAddress === <span class="string">'::1'</span> || clientIpAddress === <span class="string">'127.0.0.1'</span>) {</span><br><span class="line">            clientIpAddress = <span class="string">'Localhost'</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加ipAddress字段到data对象</span></span><br><span class="line">        data.ipAddress = clientIpAddress;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 默认设备名称</span></span><br><span class="line">        <span class="keyword">if</span> (!data.deviceName || data.deviceName.trim() === <span class="string">""</span>) {</span><br><span class="line">            data.deviceName = <span class="string">"匿名设备"</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加消息发送时间</span></span><br><span class="line">        data.timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加消息到数据库中</span></span><br><span class="line">        db.run(<span class="string">"INSERT INTO messages (content, deviceName, ipAddress, timestamp) VALUES (?, ?, ?, ?)"</span>,</span><br><span class="line">            [data.text, data.deviceName, clientIpAddress, data.timestamp],</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{  <span class="comment">// 使用函数关键字以便访问 this.lastID</span></span><br><span class="line">                <span class="keyword">if</span> (err) {</span><br><span class="line">                    <span class="built_in">console</span>.error(<span class="string">"插入数据库出错:"</span>, err);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                data.id = <span class="built_in">this</span>.lastID;  <span class="comment">// 获取新插入的行的 ID</span></span><br><span class="line">                messageHistory.push(data);  <span class="comment">// 将新消息添加到历史记录</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'通过套接字收到的消息:'</span>, data.text);</span><br><span class="line">            }</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        io.emit(<span class="string">'receive text'</span>, formatMessageForEmission(data));</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0x9-2-7-处理DELETE请求删数据库消息"><a href="#0x9-2-7-处理DELETE请求删数据库消息" class="headerlink" title="0x9.2.7 处理DELETE请求删数据库消息"></a>0x9.2.7 处理DELETE请求删数据库消息</h4><p>当收到HTTP DELETE请求时，根据指定的消息ID从数据库中删除相应的消息记录；若删除过程中出现错误，则返回错误信息，否则通知请求者消息已被删除。如果未提供有效的消息ID，则返回“无效的消息ID”错误。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">app.delete(<span class="string">'/message/:id'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> messageId = req.params.id;</span><br><span class="line">    <span class="keyword">if</span> (messageId) {</span><br><span class="line">        db.run(<span class="string">"DELETE FROM messages WHERE id=?"</span>, [messageId], <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (err) {</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">"从数据库删除消息出错:"</span>, err);</span><br><span class="line">                res.status(<span class="number">500</span>).send({<span class="attr">error</span>: <span class="string">"删除消息失败"</span>});</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从 messageHistory 数组中删除消息</span></span><br><span class="line">            <span class="keyword">const</span> index = messageHistory.findIndex(<span class="function"><span class="params">message</span> =&gt;</span> message.id === <span class="built_in">Number</span>(messageId));</span><br><span class="line">            <span class="keyword">if</span> (index !== -<span class="number">1</span>) {</span><br><span class="line">                messageHistory.splice(index, <span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            res.send({<span class="attr">status</span>: <span class="string">"消息已删除"</span>});</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res.status(<span class="number">400</span>).send({<span class="attr">error</span>: <span class="string">"无效的消息ID"</span>});</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>





<h2 id="0xA-Docker封装与测试"><a href="#0xA-Docker封装与测试" class="headerlink" title="0xA Docker封装与测试"></a>0xA Docker封装与测试</h2><p>部署Node.js网站到QNAP NAS上的一个优雅的方式是使用Docker。这种方法提供了隔离，便于管理和升级，而不会影响主机系统</p>
<h3 id="0xA-1-Docker环境准备"><a href="#0xA-1-Docker环境准备" class="headerlink" title="0xA.1 Docker环境准备"></a>0xA.1 Docker环境准备</h3><h4 id="0xA-1-1-创建Dockerfile"><a href="#0xA-1-1-创建Dockerfile" class="headerlink" title="0xA.1.1 创建Dockerfile"></a>0xA.1.1 创建Dockerfile</h4><ol>
<li><p><strong>打开终端或命令提示符</strong>：导航到Node.js项目的根目录。</p>
</li>
<li><p><strong>创建一个新的Dockerfile</strong>：</p>
<p>如果使用的是Linux或Mac，可以在终端中输入以下命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch Dockerfile</span><br></pre></td></tr></tbody></table></figure>

<p>如果在Windows上，可以使用命令提示符或PowerShell并输入以下命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span>. &gt; Dockerfile</span><br></pre></td></tr></tbody></table></figure></li>
<li><p><strong>编辑Dockerfile</strong>：</p>
<p>使用喜欢的文本编辑器打开新创建的Dockerfile。例如，可以使用VS Code、Notepad++、vim等。</p>
</li>
<li><p><strong>在Dockerfile中输入内容</strong>：</p>
<p>复制上文给出的Dockerfile内容，并粘贴到的Dockerfile中：</p>
</li>
</ol>
<figure class="highlight dockerfile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者选择的其他Node.js版本</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span> AS build-stage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/src/app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将package.json和package-lock.json文件复制到工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package*.json ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装应用程序的依赖项</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制应用程序的源代码到工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="comment"># 或的应用程序运行的其他端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义Docker容器的启动命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"npm"</span>, <span class="string">"start"</span>]</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>保存并关闭文件</strong></p>
<h4 id="0xA-1-2-构建Docker镜像"><a href="#0xA-1-2-构建Docker镜像" class="headerlink" title="0xA.1.2 构建Docker镜像"></a>0xA.1.2 构建Docker镜像</h4><p>在项目的目录中执行以下命令，以构建一个Docker镜像：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t realtimetext .</span><br></pre></td></tr></tbody></table></figure>

<p>要确保的镜像已经正确构建，可以使用以下命令列出所有本地的Docker镜像：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xA-1-3-运行Docker容器"><a href="#0xA-1-3-运行Docker容器" class="headerlink" title="0xA.1.3 运行Docker容器"></a>0xA.1.3 运行Docker容器</h4><p>确保Docker已安装并正在运行，然后运行以下命令以启动的Node.js应用：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 4000:3000 realtime_text</span><br></pre></td></tr></tbody></table></figure>

<h3 id="0xA-2-导出容器上传并运行"><a href="#0xA-2-导出容器上传并运行" class="headerlink" title="0xA.2 导出容器上传并运行"></a>0xA.2 导出容器上传并运行</h3><h4 id="0xA-2-1-导出Docker容器"><a href="#0xA-2-1-导出Docker容器" class="headerlink" title="0xA.2.1 导出Docker容器"></a>0xA.2.1 导出Docker容器</h4><p>首先，需要确定一个有效的路径来保存tar文件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir docker-images</span><br></pre></td></tr></tbody></table></figure>

<p>查看当前运行的docker ID</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></tbody></table></figure>

<p>将容器提交为新的Docker镜像</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit [CONTAINER_ID] realtime_text</span><br></pre></td></tr></tbody></table></figure>

<p>这应该会将的<code>realtime_text</code>镜像保存为<code>realtime_text.tar</code>文件，位于<code>docker-images/</code>目录下</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o docker-images/realtime_text.tar realtime_text</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xA-2-2-上传Docker容器"><a href="#0xA-2-2-上传Docker容器" class="headerlink" title="0xA.2.2 上传Docker容器"></a>0xA.2.2 上传Docker容器</h4><ol>
<li><p>需要确保在QNAP中的FileStation创建一个名为<code>Container</code>的目录</p>
</li>
<li><p>在App Center中搜索并安装<code>Container Station</code>，等待服务启动完成就可以打开了</p>
</li>
<li><p>打开<strong>映像</strong>页面，点击右上角的<strong>导入</strong>，从<strong>本地计算机</strong>选择刚导出的Docker镜像文件<strong>realtime_text</strong>，再点击导入</p>
</li>
</ol>
<h4 id="0xA-2-3-运行Docker容器"><a href="#0xA-2-3-运行Docker容器" class="headerlink" title="0xA.2.3 运行Docker容器"></a>0xA.2.3 运行Docker容器</h4><p>在容器页面启动名为<strong>realtime_text</strong>的容器，查看其详细信息及Web URL：<a href="http://192.168.50.145:32769，就是部署后的网页地址">http://192.168.50.145:32769，就是部署后的网页地址</a></p>
<h3 id="0xA-3-维护容器占用空间"><a href="#0xA-3-维护容器占用空间" class="headerlink" title="0xA.3 维护容器占用空间"></a>0xA.3 维护容器占用空间</h3><p>长期发送图片消息会导致upload目录占用较大空间，必要情况下可以在容器页面选择容器后的设置按钮，选择执行<code>/bin/sh</code>控制台</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> uploads</span><br><span class="line">rm *</span><br></pre></td></tr></tbody></table></figure>




<h2 id="0xB-常见问题与解决方案"><a href="#0xB-常见问题与解决方案" class="headerlink" title="0xB 常见问题与解决方案"></a>0xB 常见问题与解决方案</h2><h3 id="0xB-1-构建失败"><a href="#0xB-1-构建失败" class="headerlink" title="0xB.1 构建失败"></a>0xB.1 构建失败</h3><ul>
<li><p>在构建Docker时出现任何问题请先确保你在<strong>realtime_text</strong>根目录下</p>
</li>
<li><p>构建docker的镜像名必须是小写</p>
</li>
<li><p>构建docker镜像必须指定导出目录</p>
</li>
<li><p>如果你在Linux下创建docker请确保相关文件有执行的权限</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x script_name.sh</span><br><span class="line">./script_name.sh</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="0xB-2-端口占用"><a href="#0xB-2-端口占用" class="headerlink" title="0xB.2 端口占用"></a>0xB.2 端口占用</h3><p> 在运行时报告了一个端口占用错误</p>
  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">“node:events:491</span><br><span class="line">      throw er; // Unhandled <span class="string">'error'</span> event</span><br><span class="line">      ^</span><br><span class="line">Error: listen EADDRINUSE: address already <span class="keyword">in</span> use :::3000</span><br><span class="line">    at Server.setupListenHandle [as _listen2] (node:net:1485:16)</span><br><span class="line">    at listenInCluster (node:net:1533:12)</span><br><span class="line">    at Server.listen (node:net:1621:7)</span><br><span class="line">    at Object.&lt;anonymous&gt; (D:\code\win-code\NodeJS\realtime_text\server.js:60:8)</span><br><span class="line">    at Module._compile (node:internal/modules/cjs/loader:1159:14)</span><br><span class="line">    at Module._extensions..js (node:internal/modules/cjs/loader:1213:10)</span><br><span class="line">    at Module.load (node:internal/modules/cjs/loader:1037:32)</span><br><span class="line">    at Module._load (node:internal/modules/cjs/loader:878:12)</span><br><span class="line">    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)</span><br><span class="line">    at node:internal/main/run_main_module:23:47</span><br><span class="line">Emitted <span class="string">'error'</span> event on Server instance at:</span><br><span class="line">    at emitErrorNT (node:net:1512:8)</span><br><span class="line">    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {</span><br><span class="line">  code: <span class="string">'EADDRINUSE'</span>,</span><br><span class="line">  errno: -4091,</span><br><span class="line">  syscall: <span class="string">'listen'</span>,</span><br><span class="line">  address: <span class="string">'::'</span>,</span><br><span class="line">  port: 3000</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Node.js v18.12.1”</span><br></pre></td></tr></tbody></table></figure>

<p>  这个错误 <code>Error: listen EADDRINUSE: address already in use :::3000</code> 意味着端口 3000 已经被其他程序或者相同的程序的另一个实例使用了。你有几种方式来解决这个问题：</p>
<ol>
<li><p><strong>杀掉使用该端口的进程</strong></p>
<ol>
<li>在 Windows 上：<ol>
<li>打开命令行窗口，然后运行 <code>netstat -ano | findstr :3000</code>。</li>
<li>这会显示使用端口 3000 的所有进程。找到进程 ID（PID）。</li>
<li>执行 <code>taskkill /PID &lt;PID&gt; /F</code> 来杀掉进程。</li>
</ol>
</li>
<li>在 macOS 或 Linux 上：<ol>
<li>打开终端，然后运行 <code>lsof -i :3000</code>。</li>
<li>这会显示使用端口 3000 的所有进程。找到进程 ID（PID）。</li>
<li>执行 <code>kill -9 &lt;PID&gt;</code> 来杀掉进程。</li>
</ol>
</li>
</ol>
</li>
<li><p><strong>更改应用程序使用的端口</strong></p>
<p>在你的 <code>server.js</code> 文件中，找到下面这行代码：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">3000</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>你可以更改 3000 到其他未被使用的端口号，例如：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">4000</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>然后重新运行你的应用程序。</p>
</li>
<li><p><strong>重启计算机</strong></p>
<p>如果上面的方法没有解决问题或者你不确定如何进行，重启计算机通常能够解决端口冲突的问题。</p>
<p>希望这能帮到你！</p>
</li>
</ol>
<h3 id="0xB-3-数据库自增ID列"><a href="#0xB-3-数据库自增ID列" class="headerlink" title="0xB.3 数据库自增ID列"></a>0xB.3 数据库自增ID列</h3><p>DataGrip 是一个流行的数据库管理工具，允许你通过其图形界面来进行各种数据库操作。要在 DataGrip 中修改表的 <code>id</code> 列为自增，可以按照以下步骤进行：</p>
<ol>
<li><p><strong>打开 DataGrip</strong> 并连接到你的 SQLite 数据库。</p>
</li>
<li><p>在左侧的 <strong>数据库浏览器</strong> 中，找到你的表。</p>
</li>
<li><p><strong>右键点击</strong> 你想要修改的表，然后选择 <strong>Modify Table</strong>。</p>
</li>
<li><p>在打开的窗口中，找到 <code>id</code> 列。</p>
</li>
<li><p>选中 <code>id</code> 列，然后在右侧的属性面板中找到 <strong>Identity</strong> 或 <strong>Auto Increment</strong> 选项并勾选。</p>
</li>
<li><p><strong>右键点击</strong> 该列名，并从上下文菜单中选择 <strong>Set Primary Key</strong>。</p>
</li>
<li><p>最后，点击窗口下方的 <strong>提交</strong> 或 <strong>应用</strong> 按钮来保存更改。</p>
</li>
</ol>
<p>请注意，不同的数据库系统和不同的版本可能会有些微差异。确保在进行此类操作之前备份你的数据。</p>
<p>如果 DataGrip 不直接支持 SQLite 的自增特性或有任何其他问题，你可能需要使用 SQL 语句来手动修改表结构，或者像之前所描述的那样，通过创建一个新表、复制数据、删除旧表、然后重命名新表的方式来达到目的。</p>
<h3 id="0xB-4-确保前端页面与数据库内容同步"><a href="#0xB-4-确保前端页面与数据库内容同步" class="headerlink" title="0xB.4 确保前端页面与数据库内容同步"></a>0xB.4 确保前端页面与数据库内容同步</h3><p>前端消息的ID与数据库ID对应。若前端删除消息失败，可能是ID不匹配或Docker中的sqlite3库问题。若需手动删除消息，以下是相关sql语句。<strong>不使用Docker容器可避免该问题，并注意Docker会将24小时制改为12小时制</strong></p>
<h4 id="0xB-4-1-连接数据库"><a href="#0xB-4-1-连接数据库" class="headerlink" title="0xB.4.1 连接数据库"></a>0xB.4.1 连接数据库</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 messages.db</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-2-查询表"><a href="#0xB-4-2-查询表" class="headerlink" title="0xB.4.2 查询表"></a>0xB.4.2 查询表</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM messages;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-3-查ID列"><a href="#0xB-4-3-查ID列" class="headerlink" title="0xB.4.3 查ID列"></a>0xB.4.3 查ID列</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id FROM messages;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-4-删除指定ID行"><a href="#0xB-4-4-删除指定ID行" class="headerlink" title="0xB.4.4 删除指定ID行"></a>0xB.4.4 删除指定ID行</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM messages WHERE id = 5;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-5-删除指定多行ID"><a href="#0xB-4-5-删除指定多行ID" class="headerlink" title="0xB.4.5 删除指定多行ID"></a>0xB.4.5 删除指定多行ID</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM messages WHERE id IN (3, 4, 5);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-6-查询指定ID列的值"><a href="#0xB-4-6-查询指定ID列的值" class="headerlink" title="0xB.4.6 查询指定ID列的值"></a>0xB.4.6 查询指定ID列的值</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM messages WHERE id = 5;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-7-查询指定多行ID列的值"><a href="#0xB-4-7-查询指定多行ID列的值" class="headerlink" title="0xB.4.7 查询指定多行ID列的值"></a>0xB.4.7 查询指定多行ID列的值</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM messages WHERE id IN (3, 4, 5);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-8-修改指定ID"><a href="#0xB-4-8-修改指定ID" class="headerlink" title="0xB.4.8 修改指定ID"></a>0xB.4.8 修改指定ID</h4><p>在这个语句中，<code>18</code> 替代了第一个 <code>?</code>，<code>21</code> 替代了第二个 <code>?</code>，而 <code>21</code> 替代了第三个 <code>?</code>。这样的话，当你执行这个SQL语句时，它会将 <code>messages</code> 表中 <code>rowid</code> 为 21，且 <code>id</code> 为 21 的行的 <code>id</code> 字段的值更新为 18。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE "messages" SET "id" = 18 WHERE "rowid" = 21 AND "id" = 21</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-9-SSH连接正在运行的docker"><a href="#0xB-4-9-SSH连接正在运行的docker" class="headerlink" title="0xB.4.9 SSH连接正在运行的docker"></a>0xB.4.9 SSH连接正在运行的docker</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it &lt;container_id_or_name&gt; /bin/bash</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-A-docker中安装vim"><a href="#0xB-4-A-docker中安装vim" class="headerlink" title="0xB.4.A docker中安装vim"></a>0xB.4.A docker中安装vim</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install -y vim</span><br></pre></td></tr></tbody></table></figure>

<h4 id="0xB-4-B-重置id列自增值"><a href="#0xB-4-B-重置id列自增值" class="headerlink" title="0xB.4.B 重置id列自增值"></a>0xB.4.B 重置id列自增值</h4><p>查询当前最大值</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MAX(id) FROM messages;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>将自增ID的SEQ设置为最大ID值：</strong>使用以下SQL语句来设置自增ID列的序列（sequence）为当前最大ID值</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE sqlite_sequence SET seq = 31 WHERE name = 'messages';</span><br></pre></td></tr></tbody></table></figure>

<p><strong>删除消息后需重启docker容器生效</strong></p>
<h2 id="0xC-运行效果"><a href="#0xC-运行效果" class="headerlink" title="0xC 运行效果"></a>0xC 运行效果</h2><p>等一会，加载图片比较慢</p>
<h3 id="0xC-1-大屏幕设备"><a href="#0xC-1-大屏幕设备" class="headerlink" title="0xC.1 大屏幕设备"></a>0xC.1 大屏幕设备</h3><p><img src="https://pic.imgdb.cn/item/6508153d204c2e34d39a873c.jpg"></p>
<p><img src="https://pic.imgdb.cn/item/6508153d204c2e34d39a874b.jpg"></p>
<h3 id="0xC-2-小屏幕设备"><a href="#0xC-2-小屏幕设备" class="headerlink" title="0xC.2 小屏幕设备"></a>0xC.2 小屏幕设备</h3><img src="https://pic.imgdb.cn/item/6508153e204c2e34d39a8784.png" style="zoom: 25%;">

<img src="https://pic.imgdb.cn/item/6508153d204c2e34d39a875c.png" style="zoom:25%;">

                </div>
                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                基于Node.js跨平台局域网消息传输与QNAP部署
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2023/08/28/2023-08-28-node-js-kua-ping-tai-ju-yu-wang-xiao-xi-chuan-shu-yu-qnap-bu-shu-shou-ce/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    作者
                </div>
                <div class="content">WisdomEquan</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    发布于
                </div>
                <div class="content">2023-08-28 01:29</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    许可
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="复制版权信息" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/QNAP/">QNAP</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2024/02/25/2024-02-25-hexo-huan-jing-pei-zhi/"
                                   title="Hexo环境配置"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Hexo环境配置</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2023/07/01/2023-07-01-mcreator-zhi-zuo-zi-ding-yi-gong-zuo-tai/"
                                   title="基于MCreator+Fabric+Forge的自定义工作台"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">基于MCreator+Fabric+Forge的自定义工作台</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc left-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <!-- use hexo-blog-encrypt -->
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x1-%E5%BC%95%E8%A8%80"><span class="nav-text">0x1 引言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x1-1-%E7%9B%AE%E7%9A%84%E4%B8%8E%E8%83%8C%E6%99%AF"><span class="nav-text">0x1.1 目的与背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x1-2-%E7%9B%AE%E6%A0%87%E5%8F%97%E4%BC%97"><span class="nav-text">0x1.2 目标受众</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x2-%E5%BF%85%E8%A6%81%E7%9A%84%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86%E8%A7%A3%E9%87%8A"><span class="nav-text">0x2 必要的理论知识解释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x2-1-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">0x2.1 基础概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x2-2-%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%83%8C%E6%99%AF"><span class="nav-text">0x2.2 相关技术背景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x3-Node-js%E5%8E%9F%E5%9E%8B%E5%BC%80%E5%8F%91"><span class="nav-text">0x3 Node.js原型开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x3-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-text">0x3.1 环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x3-2-%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-text">0x3.2 基本功能实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x4-%E6%8C%89%E9%9C%80%E5%A4%8D%E5%88%B6%EF%BC%8C%E6%97%A0%E9%9C%80%E6%B7%B1%E7%A9%B6%E5%AD%A6%E4%B9%A0"><span class="nav-text">0x4 按需复制，无需深究学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x4-1-index-html"><span class="nav-text">0x4.1 index.html</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x4-2-server-js"><span class="nav-text">0x4.2 server.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x4-3-%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%B7%B2%E6%89%93%E5%8C%85%E5%A5%BD%E7%9A%84"><span class="nav-text">0x4.3 直接下载已打包好的</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x5-%E7%95%8C%E9%9D%A2%E5%9B%BE%E5%83%8F%E4%BC%98%E5%8C%96%E4%B8%8E%E9%80%82%E9%85%8D"><span class="nav-text">0x5 界面图像优化与适配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-1-%E6%B6%88%E6%81%AF%E5%B1%95%E7%A4%BA%E4%B8%8E%E8%AE%BE%E5%A4%87%E8%87%AA%E9%80%82%E5%BA%94"><span class="nav-text">0x5.1 消息展示与设备自适应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-1-1-%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%E6%B6%88%E6%81%AF%E4%B8%AD%E5%BF%83"><span class="nav-text">0x5.1.1 设备信息消息中心</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-1-2-iPhone%E9%A1%B5%E9%9D%A2%E8%87%AA%E9%80%82%E5%BA%94"><span class="nav-text">0x5.1.2 iPhone页面自适应</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-2-%E5%9B%BE%E5%83%8F%E4%BC%98%E5%8C%96%E4%B8%8E%E4%BC%A0%E8%BE%93"><span class="nav-text">0x5.2  图像优化与传输</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-2-1-%E5%9B%BE%E5%83%8F%E4%BC%A0%E8%BE%93%E9%80%BB%E8%BE%91"><span class="nav-text">0x5.2.1 图像传输逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-2-2-%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.2.2 图片显示与优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E5%A4%9A%E5%8F%91%E5%AF%BC%E8%87%B4%E6%A0%87%E7%AD%BE%E8%A2%AB%E9%81%AE%E6%8C%A1"><span class="nav-text">消息多发导致标签被遮挡</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-3-iPhone%E7%95%8C%E9%9D%A2%E4%B8%8E%E4%BA%A4%E4%BA%92%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.3 iPhone界面与交互优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-1-%E7%82%B9%E5%87%BB%E5%9B%BE%E7%89%87%E6%94%BE%E5%A4%A7%E5%8E%9F%E5%B0%BA%E5%AF%B8"><span class="nav-text">0x5.3.1 点击图片放大原尺寸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-2-iPhone%E6%B5%8F%E8%A7%88%E5%99%A8send%E6%8C%89%E9%92%AE%E8%B6%85%E5%B1%8F"><span class="nav-text">0x5.3.2 iPhone浏览器send按钮超屏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-3-iPhone%E8%BE%93%E5%85%A5%E6%A1%86%E8%B6%85%E5%87%BA%E5%B1%8F%E5%B9%95"><span class="nav-text">0x5.3.3 iPhone输入框超出屏幕</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-4-iPhone%E6%8C%89%E9%92%AE%E8%BE%93%E5%85%A5%E6%A1%86%E9%87%8D%E5%8F%A0%E4%BF%AE%E6%AD%A3"><span class="nav-text">0x5.3.4 iPhone按钮输入框重叠修正</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-5-iPhone%E5%B8%83%E5%B1%80%E5%AF%B9%E9%BD%90%E4%B8%8E%E7%82%B9%E5%87%BB%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.3.5 iPhone布局对齐与点击优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-6-%E6%8E%A7%E4%BB%B6%E8%BE%B9%E7%BC%98%E9%87%8D%E5%8F%A0%E4%B8%8EiPhone%E7%82%B9%E5%87%BB"><span class="nav-text">0x5.3.6 控件边缘重叠与iPhone点击</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-7-iPhone%E4%B8%8A%E4%B8%A4%E4%BE%A7%E9%97%B4%E8%B7%9D%E9%97%AE%E9%A2%98"><span class="nav-text">0x5.3.7 iPhone上两侧间距问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-8-iPhone%E8%BE%93%E5%85%A5%E6%A1%86%E5%AE%BD%E5%BA%A6%E5%BC%82%E5%B8%B8"><span class="nav-text">0x5.3.8 iPhone输入框宽度异常</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-9-iPhone%E5%B8%83%E5%B1%80%E6%A0%A1%E9%AA%8C%E4%B8%8E%E6%BB%91%E5%8A%A8%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.3.9 iPhone布局校验与滑动优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-A-iPhone%E5%B8%83%E5%B1%80%E9%81%AE%E6%8C%A1%E4%B8%8E%E9%97%B4%E8%B7%9D%E4%BF%AE%E6%AD%A3"><span class="nav-text">0x5.3.A iPhone布局遮挡与间距修正</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-4-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E8%AE%BE%E5%A4%87%E5%90%8D%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="nav-text">0x5.4 消息发送与设备名自动填充</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-4-1-%E5%8F%91%E9%80%81%E5%90%8E%E6%B8%85%E9%99%A4%E5%B7%B2%E9%80%89%E5%9B%BE%E5%83%8F"><span class="nav-text">0x5.4.1 发送后清除已选图像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-4-2-%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E8%AE%BE%E5%A4%87%E5%90%8D%E7%A7%B0"><span class="nav-text">0x5.4.2 自动填充设备名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-4-3-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%90%8E%E8%87%AA%E5%8A%A8%E6%B8%85%E7%A9%BA%E8%BE%93%E5%85%A5%E6%A1%86"><span class="nav-text">0x5.4.3 消息发送后自动清空输入框</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-5-%E5%A4%A7%E5%B1%8F%E9%80%82%E9%85%8D%E4%B8%8E%E6%8E%A7%E4%BB%B6%E5%B8%83%E5%B1%80%E8%B0%83%E6%95%B4"><span class="nav-text">0x5.5 大屏适配与控件布局调整</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-5-1-Windows%E5%B1%85%E4%B8%AD-iPhone%E9%80%90%E8%A1%8C"><span class="nav-text">0x5.5.1 Windows居中 iPhone逐行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-5-2-%E6%89%A9%E5%A4%A7%E5%A4%A7%E5%B1%8F%E5%B9%95%E5%BA%95%E9%83%A8%E6%8E%A7%E4%BB%B6%E5%B0%BA%E5%AF%B8"><span class="nav-text">0x5.5.2 扩大大屏幕底部控件尺寸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-5-3-%E5%A4%A7%E5%B1%8F%E5%B9%95%E8%BE%93%E5%85%A5%E6%A1%86%E9%95%BF%E5%BA%A6%E5%8F%8A%E6%8E%A7%E4%BB%B6%E9%97%B4%E8%B7%9D"><span class="nav-text">0x5.5.3 大屏幕输入框长度及控件间距</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-6-%E5%A2%9E%E5%8A%A0%E6%B7%B1%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98"><span class="nav-text">0x5.6 增加深浅色主题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x6-%E5%AF%BC%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93"><span class="nav-text">0x6 导入自定义字体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x7-%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="nav-text">0x7 添加自动加载历史记录功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x8-%E6%B7%BB%E5%8A%A0%E6%B6%88%E6%81%AF%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%92%8C%E6%97%B6%E9%97%B4%E6%88%B3"><span class="nav-text">0x8 添加消息代码格式化和时间戳</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x9-%E5%A2%9E%E5%8A%A0%E6%B6%88%E6%81%AF%E5%88%A0%E9%99%A4%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0x9 增加消息删除与数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x9-1-%E5%A2%9E%E5%8A%A0%E6%B6%88%E6%81%AF%E5%88%A0%E9%99%A4"><span class="nav-text">0x9.1 增加消息删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x9-2-%E5%89%8D%E7%AB%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E8%81%94%E5%8A%A8%E5%88%A0%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2 前端数据库联动删消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0x9.2.1 创建数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-2-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="nav-text">0x9.2.2 创建表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-3-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%80%E6%9C%89%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2.3 读取数据库所有消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-4-%E4%BF%9D%E5%AD%98%E5%89%8D%E7%AB%AF%E6%B6%88%E6%81%AF%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0x9.2.4 保存前端消息到数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-5-%E5%B9%BF%E6%92%AD%E6%89%80%E6%9C%89%E6%B6%88%E6%81%AF%E7%BB%99%E7%94%A8%E6%88%B7"><span class="nav-text">0x9.2.5 广播所有消息给用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-6-%E5%B9%BF%E6%92%ADSocket%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2.6 广播Socket客户端消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-7-%E5%A4%84%E7%90%86DELETE%E8%AF%B7%E6%B1%82%E5%88%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2.7 处理DELETE请求删数据库消息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xA-Docker%E5%B0%81%E8%A3%85%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="nav-text">0xA Docker封装与测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0xA-1-Docker%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text">0xA.1 Docker环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-1-1-%E5%88%9B%E5%BB%BADockerfile"><span class="nav-text">0xA.1.1 创建Dockerfile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-1-2-%E6%9E%84%E5%BB%BADocker%E9%95%9C%E5%83%8F"><span class="nav-text">0xA.1.2 构建Docker镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-1-3-%E8%BF%90%E8%A1%8CDocker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.1.3 运行Docker容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xA-2-%E5%AF%BC%E5%87%BA%E5%AE%B9%E5%99%A8%E4%B8%8A%E4%BC%A0%E5%B9%B6%E8%BF%90%E8%A1%8C"><span class="nav-text">0xA.2 导出容器上传并运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-2-1-%E5%AF%BC%E5%87%BADocker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.2.1 导出Docker容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-2-2-%E4%B8%8A%E4%BC%A0Docker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.2.2 上传Docker容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-2-3-%E8%BF%90%E8%A1%8CDocker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.2.3 运行Docker容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xA-3-%E7%BB%B4%E6%8A%A4%E5%AE%B9%E5%99%A8%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4"><span class="nav-text">0xA.3 维护容器占用空间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xB-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">0xB 常见问题与解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-1-%E6%9E%84%E5%BB%BA%E5%A4%B1%E8%B4%A5"><span class="nav-text">0xB.1 构建失败</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-2-%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8"><span class="nav-text">0xB.2 端口占用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%87%AA%E5%A2%9EID%E5%88%97"><span class="nav-text">0xB.3 数据库自增ID列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-4-%E7%A1%AE%E4%BF%9D%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E5%AE%B9%E5%90%8C%E6%AD%A5"><span class="nav-text">0xB.4 确保前端页面与数据库内容同步</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-1-%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0xB.4.1 连接数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-2-%E6%9F%A5%E8%AF%A2%E8%A1%A8"><span class="nav-text">0xB.4.2 查询表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-3-%E6%9F%A5ID%E5%88%97"><span class="nav-text">0xB.4.3 查ID列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-4-%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9AID%E8%A1%8C"><span class="nav-text">0xB.4.4 删除指定ID行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-5-%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E5%A4%9A%E8%A1%8CID"><span class="nav-text">0xB.4.5 删除指定多行ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-6-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9AID%E5%88%97%E7%9A%84%E5%80%BC"><span class="nav-text">0xB.4.6 查询指定ID列的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-7-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E5%A4%9A%E8%A1%8CID%E5%88%97%E7%9A%84%E5%80%BC"><span class="nav-text">0xB.4.7 查询指定多行ID列的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-8-%E4%BF%AE%E6%94%B9%E6%8C%87%E5%AE%9AID"><span class="nav-text">0xB.4.8 修改指定ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-9-SSH%E8%BF%9E%E6%8E%A5%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84docker"><span class="nav-text">0xB.4.9 SSH连接正在运行的docker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-A-docker%E4%B8%AD%E5%AE%89%E8%A3%85vim"><span class="nav-text">0xB.4.A docker中安装vim</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-B-%E9%87%8D%E7%BD%AEid%E5%88%97%E8%87%AA%E5%A2%9E%E5%80%BC"><span class="nav-text">0xB.4.B 重置id列自增值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xC-%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C"><span class="nav-text">0xC 运行效果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0xC-1-%E5%A4%A7%E5%B1%8F%E5%B9%95%E8%AE%BE%E5%A4%87"><span class="nav-text">0xC.1 大屏幕设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xC-2-%E5%B0%8F%E5%B1%8F%E5%B9%95%E8%AE%BE%E5%A4%87"><span class="nav-text">0xC.2 小屏幕设备</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2017</span>&nbsp;-&nbsp;2024
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">WisdomEquan</a>
        
    </div>

    <div class="theme-info info-item">
        由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    <div class="count-info info-item">
        

        

        
    </div>

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools left-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-toggle-theme-mode flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <!-- use hexo-blog-encrypt -->
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x1-%E5%BC%95%E8%A8%80"><span class="nav-text">0x1 引言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x1-1-%E7%9B%AE%E7%9A%84%E4%B8%8E%E8%83%8C%E6%99%AF"><span class="nav-text">0x1.1 目的与背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x1-2-%E7%9B%AE%E6%A0%87%E5%8F%97%E4%BC%97"><span class="nav-text">0x1.2 目标受众</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x2-%E5%BF%85%E8%A6%81%E7%9A%84%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86%E8%A7%A3%E9%87%8A"><span class="nav-text">0x2 必要的理论知识解释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x2-1-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">0x2.1 基础概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x2-2-%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E8%83%8C%E6%99%AF"><span class="nav-text">0x2.2 相关技术背景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x3-Node-js%E5%8E%9F%E5%9E%8B%E5%BC%80%E5%8F%91"><span class="nav-text">0x3 Node.js原型开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x3-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-text">0x3.1 环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x3-2-%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-text">0x3.2 基本功能实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x4-%E6%8C%89%E9%9C%80%E5%A4%8D%E5%88%B6%EF%BC%8C%E6%97%A0%E9%9C%80%E6%B7%B1%E7%A9%B6%E5%AD%A6%E4%B9%A0"><span class="nav-text">0x4 按需复制，无需深究学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x4-1-index-html"><span class="nav-text">0x4.1 index.html</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x4-2-server-js"><span class="nav-text">0x4.2 server.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x4-3-%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%B7%B2%E6%89%93%E5%8C%85%E5%A5%BD%E7%9A%84"><span class="nav-text">0x4.3 直接下载已打包好的</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x5-%E7%95%8C%E9%9D%A2%E5%9B%BE%E5%83%8F%E4%BC%98%E5%8C%96%E4%B8%8E%E9%80%82%E9%85%8D"><span class="nav-text">0x5 界面图像优化与适配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-1-%E6%B6%88%E6%81%AF%E5%B1%95%E7%A4%BA%E4%B8%8E%E8%AE%BE%E5%A4%87%E8%87%AA%E9%80%82%E5%BA%94"><span class="nav-text">0x5.1 消息展示与设备自适应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-1-1-%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%E6%B6%88%E6%81%AF%E4%B8%AD%E5%BF%83"><span class="nav-text">0x5.1.1 设备信息消息中心</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-1-2-iPhone%E9%A1%B5%E9%9D%A2%E8%87%AA%E9%80%82%E5%BA%94"><span class="nav-text">0x5.1.2 iPhone页面自适应</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-2-%E5%9B%BE%E5%83%8F%E4%BC%98%E5%8C%96%E4%B8%8E%E4%BC%A0%E8%BE%93"><span class="nav-text">0x5.2  图像优化与传输</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-2-1-%E5%9B%BE%E5%83%8F%E4%BC%A0%E8%BE%93%E9%80%BB%E8%BE%91"><span class="nav-text">0x5.2.1 图像传输逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-2-2-%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.2.2 图片显示与优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E5%A4%9A%E5%8F%91%E5%AF%BC%E8%87%B4%E6%A0%87%E7%AD%BE%E8%A2%AB%E9%81%AE%E6%8C%A1"><span class="nav-text">消息多发导致标签被遮挡</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-3-iPhone%E7%95%8C%E9%9D%A2%E4%B8%8E%E4%BA%A4%E4%BA%92%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.3 iPhone界面与交互优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-1-%E7%82%B9%E5%87%BB%E5%9B%BE%E7%89%87%E6%94%BE%E5%A4%A7%E5%8E%9F%E5%B0%BA%E5%AF%B8"><span class="nav-text">0x5.3.1 点击图片放大原尺寸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-2-iPhone%E6%B5%8F%E8%A7%88%E5%99%A8send%E6%8C%89%E9%92%AE%E8%B6%85%E5%B1%8F"><span class="nav-text">0x5.3.2 iPhone浏览器send按钮超屏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-3-iPhone%E8%BE%93%E5%85%A5%E6%A1%86%E8%B6%85%E5%87%BA%E5%B1%8F%E5%B9%95"><span class="nav-text">0x5.3.3 iPhone输入框超出屏幕</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-4-iPhone%E6%8C%89%E9%92%AE%E8%BE%93%E5%85%A5%E6%A1%86%E9%87%8D%E5%8F%A0%E4%BF%AE%E6%AD%A3"><span class="nav-text">0x5.3.4 iPhone按钮输入框重叠修正</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-5-iPhone%E5%B8%83%E5%B1%80%E5%AF%B9%E9%BD%90%E4%B8%8E%E7%82%B9%E5%87%BB%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.3.5 iPhone布局对齐与点击优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-6-%E6%8E%A7%E4%BB%B6%E8%BE%B9%E7%BC%98%E9%87%8D%E5%8F%A0%E4%B8%8EiPhone%E7%82%B9%E5%87%BB"><span class="nav-text">0x5.3.6 控件边缘重叠与iPhone点击</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-7-iPhone%E4%B8%8A%E4%B8%A4%E4%BE%A7%E9%97%B4%E8%B7%9D%E9%97%AE%E9%A2%98"><span class="nav-text">0x5.3.7 iPhone上两侧间距问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-8-iPhone%E8%BE%93%E5%85%A5%E6%A1%86%E5%AE%BD%E5%BA%A6%E5%BC%82%E5%B8%B8"><span class="nav-text">0x5.3.8 iPhone输入框宽度异常</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-9-iPhone%E5%B8%83%E5%B1%80%E6%A0%A1%E9%AA%8C%E4%B8%8E%E6%BB%91%E5%8A%A8%E4%BC%98%E5%8C%96"><span class="nav-text">0x5.3.9 iPhone布局校验与滑动优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-3-A-iPhone%E5%B8%83%E5%B1%80%E9%81%AE%E6%8C%A1%E4%B8%8E%E9%97%B4%E8%B7%9D%E4%BF%AE%E6%AD%A3"><span class="nav-text">0x5.3.A iPhone布局遮挡与间距修正</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-4-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E8%AE%BE%E5%A4%87%E5%90%8D%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="nav-text">0x5.4 消息发送与设备名自动填充</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-4-1-%E5%8F%91%E9%80%81%E5%90%8E%E6%B8%85%E9%99%A4%E5%B7%B2%E9%80%89%E5%9B%BE%E5%83%8F"><span class="nav-text">0x5.4.1 发送后清除已选图像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-4-2-%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E8%AE%BE%E5%A4%87%E5%90%8D%E7%A7%B0"><span class="nav-text">0x5.4.2 自动填充设备名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-4-3-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%90%8E%E8%87%AA%E5%8A%A8%E6%B8%85%E7%A9%BA%E8%BE%93%E5%85%A5%E6%A1%86"><span class="nav-text">0x5.4.3 消息发送后自动清空输入框</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-5-%E5%A4%A7%E5%B1%8F%E9%80%82%E9%85%8D%E4%B8%8E%E6%8E%A7%E4%BB%B6%E5%B8%83%E5%B1%80%E8%B0%83%E6%95%B4"><span class="nav-text">0x5.5 大屏适配与控件布局调整</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-5-1-Windows%E5%B1%85%E4%B8%AD-iPhone%E9%80%90%E8%A1%8C"><span class="nav-text">0x5.5.1 Windows居中 iPhone逐行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-5-2-%E6%89%A9%E5%A4%A7%E5%A4%A7%E5%B1%8F%E5%B9%95%E5%BA%95%E9%83%A8%E6%8E%A7%E4%BB%B6%E5%B0%BA%E5%AF%B8"><span class="nav-text">0x5.5.2 扩大大屏幕底部控件尺寸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x5-5-3-%E5%A4%A7%E5%B1%8F%E5%B9%95%E8%BE%93%E5%85%A5%E6%A1%86%E9%95%BF%E5%BA%A6%E5%8F%8A%E6%8E%A7%E4%BB%B6%E9%97%B4%E8%B7%9D"><span class="nav-text">0x5.5.3 大屏幕输入框长度及控件间距</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x5-6-%E5%A2%9E%E5%8A%A0%E6%B7%B1%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98"><span class="nav-text">0x5.6 增加深浅色主题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x6-%E5%AF%BC%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93"><span class="nav-text">0x6 导入自定义字体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x7-%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="nav-text">0x7 添加自动加载历史记录功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x8-%E6%B7%BB%E5%8A%A0%E6%B6%88%E6%81%AF%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%92%8C%E6%97%B6%E9%97%B4%E6%88%B3"><span class="nav-text">0x8 添加消息代码格式化和时间戳</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x9-%E5%A2%9E%E5%8A%A0%E6%B6%88%E6%81%AF%E5%88%A0%E9%99%A4%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0x9 增加消息删除与数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x9-1-%E5%A2%9E%E5%8A%A0%E6%B6%88%E6%81%AF%E5%88%A0%E9%99%A4"><span class="nav-text">0x9.1 增加消息删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x9-2-%E5%89%8D%E7%AB%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E8%81%94%E5%8A%A8%E5%88%A0%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2 前端数据库联动删消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0x9.2.1 创建数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-2-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="nav-text">0x9.2.2 创建表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-3-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%80%E6%9C%89%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2.3 读取数据库所有消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-4-%E4%BF%9D%E5%AD%98%E5%89%8D%E7%AB%AF%E6%B6%88%E6%81%AF%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0x9.2.4 保存前端消息到数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-5-%E5%B9%BF%E6%92%AD%E6%89%80%E6%9C%89%E6%B6%88%E6%81%AF%E7%BB%99%E7%94%A8%E6%88%B7"><span class="nav-text">0x9.2.5 广播所有消息给用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-6-%E5%B9%BF%E6%92%ADSocket%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2.6 广播Socket客户端消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x9-2-7-%E5%A4%84%E7%90%86DELETE%E8%AF%B7%E6%B1%82%E5%88%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B6%88%E6%81%AF"><span class="nav-text">0x9.2.7 处理DELETE请求删数据库消息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xA-Docker%E5%B0%81%E8%A3%85%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="nav-text">0xA Docker封装与测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0xA-1-Docker%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text">0xA.1 Docker环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-1-1-%E5%88%9B%E5%BB%BADockerfile"><span class="nav-text">0xA.1.1 创建Dockerfile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-1-2-%E6%9E%84%E5%BB%BADocker%E9%95%9C%E5%83%8F"><span class="nav-text">0xA.1.2 构建Docker镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-1-3-%E8%BF%90%E8%A1%8CDocker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.1.3 运行Docker容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xA-2-%E5%AF%BC%E5%87%BA%E5%AE%B9%E5%99%A8%E4%B8%8A%E4%BC%A0%E5%B9%B6%E8%BF%90%E8%A1%8C"><span class="nav-text">0xA.2 导出容器上传并运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-2-1-%E5%AF%BC%E5%87%BADocker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.2.1 导出Docker容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-2-2-%E4%B8%8A%E4%BC%A0Docker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.2.2 上传Docker容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xA-2-3-%E8%BF%90%E8%A1%8CDocker%E5%AE%B9%E5%99%A8"><span class="nav-text">0xA.2.3 运行Docker容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xA-3-%E7%BB%B4%E6%8A%A4%E5%AE%B9%E5%99%A8%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4"><span class="nav-text">0xA.3 维护容器占用空间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xB-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">0xB 常见问题与解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-1-%E6%9E%84%E5%BB%BA%E5%A4%B1%E8%B4%A5"><span class="nav-text">0xB.1 构建失败</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-2-%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8"><span class="nav-text">0xB.2 端口占用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%87%AA%E5%A2%9EID%E5%88%97"><span class="nav-text">0xB.3 数据库自增ID列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xB-4-%E7%A1%AE%E4%BF%9D%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E5%AE%B9%E5%90%8C%E6%AD%A5"><span class="nav-text">0xB.4 确保前端页面与数据库内容同步</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-1-%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">0xB.4.1 连接数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-2-%E6%9F%A5%E8%AF%A2%E8%A1%A8"><span class="nav-text">0xB.4.2 查询表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-3-%E6%9F%A5ID%E5%88%97"><span class="nav-text">0xB.4.3 查ID列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-4-%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9AID%E8%A1%8C"><span class="nav-text">0xB.4.4 删除指定ID行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-5-%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E5%A4%9A%E8%A1%8CID"><span class="nav-text">0xB.4.5 删除指定多行ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-6-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9AID%E5%88%97%E7%9A%84%E5%80%BC"><span class="nav-text">0xB.4.6 查询指定ID列的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-7-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E5%A4%9A%E8%A1%8CID%E5%88%97%E7%9A%84%E5%80%BC"><span class="nav-text">0xB.4.7 查询指定多行ID列的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-8-%E4%BF%AE%E6%94%B9%E6%8C%87%E5%AE%9AID"><span class="nav-text">0xB.4.8 修改指定ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-9-SSH%E8%BF%9E%E6%8E%A5%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84docker"><span class="nav-text">0xB.4.9 SSH连接正在运行的docker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-A-docker%E4%B8%AD%E5%AE%89%E8%A3%85vim"><span class="nav-text">0xB.4.A docker中安装vim</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0xB-4-B-%E9%87%8D%E7%BD%AEid%E5%88%97%E8%87%AA%E5%A2%9E%E5%80%BC"><span class="nav-text">0xB.4.B 重置id列自增值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xC-%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C"><span class="nav-text">0xC 运行效果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0xC-1-%E5%A4%A7%E5%B1%8F%E5%B9%95%E8%AE%BE%E5%A4%87"><span class="nav-text">0xC.1 大屏幕设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0xC-2-%E5%B0%8F%E5%B1%8F%E5%B9%95%E8%AE%BE%E5%A4%87"><span class="nav-text">0xC.2 小屏幕设备</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        
            
<script src="/js/post/copyright-info.js"></script>

        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



    
        
    

</body>
</html>
